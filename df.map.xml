<data-definition>
    <struct-type type-name='coord2d' custom-methods='true' comment='not a real structure'>
        <int16_t name='x' init-value='-30000'/>
        <int16_t name='y' init-value='-30000'/>

        <custom-methods>
            <cmethod name='isValid'/>
            <cmethod name='clear'/>
        </custom-methods>

        <code-helper name='describe'>(fmt "(~A,~A)" $.x $.y)</code-helper>
    </struct-type>

    <struct-type type-name='coord2d_path' custom-methods='true' comment='not a real structure'>
        <stl-vector type-name='int16_t' name='x'/>
        <stl-vector type-name='int16_t' name='y'/>

        <custom-methods>
            <cmethod name='size'/>
            <cmethod name='erase'/>
        </custom-methods>
        <code-helper name='describe'>
            (fmt "[~A]" $.x.count)
            (loop for i from 0 below (min $.x.count 3)
              collect (fmt "(~A,~A)" $.x[i] $.y[i]))
            (when (> $.x.count 3) "...")
        </code-helper>
    </struct-type>

    <struct-type type-name='coord' custom-methods='true' comment='not a real structure'>
        <int16_t name='x' init-value='-30000'/>
        <int16_t name='y' init-value='-30000'/>
        <int16_t name='z' init-value='-30000'/>

        <extra-include type-name='coord2d'/>
        <custom-methods>
            <cmethod name='isValid'/>
            <cmethod name='clear'/>
        </custom-methods>

        <code-helper name='describe'>(fmt "(~A,~A,~A)" $.x $.y $.z)</code-helper>
    </struct-type>

    <struct-type type-name='coord_path' custom-methods='true' comment='not a real structure'>
        <stl-vector type-name='int16_t' name='x'/>
        <stl-vector type-name='int16_t' name='y'/>
        <stl-vector type-name='int16_t' name='z'/>

        <custom-methods>
            <cmethod name='empty'/>
            <cmethod name='size'/>
            <cmethod name='clear'/>
            <cmethod name='erase'/>
        </custom-methods>

        <code-helper name='describe'>
            (fmt "[~A]" $.x.count)
            (loop for i from 0 below (min $.x.count 3)
              collect (fmt "(~A,~A,~A)" $.x[i] $.y[i] $.z[i]))
            (when (> $.x.count 3) "...")
        </code-helper>
    </struct-type>

    <enum-type type-name='tile_traffic' base-type='uint32_t'> bay12: TRAFFIC_DESIGNATION_*
        <enum-item name='Normal'/>
        <enum-item name='Low'/>
        <enum-item name='High'/>
        <enum-item name='Restricted'/>
    </enum-type>

    <enum-type type-name='tile_dig_designation' base-type='uint32_t'> bay12: DIG_DESIGNATION_*
        <enum-item name='No' comment='no designation'/>
        <enum-item name='Default' comment='dig walls, remove stairs and ramps, gather plants, fell trees'/>
        <enum-item name='UpDownStair'/>
        <enum-item name='Channel'/>
        <enum-item name='Ramp'/>
        <enum-item name='DownStair'/>
        <enum-item name='UpStair'/>
    </enum-type>

    <enum-type type-name='tile_liquid' base-type='uint32_t'> bay12: LIQUID_TYPE_*
        <enum-item name='Water'/>
        <enum-item name='Magma'/>
    </enum-type>

    <bitfield-type type-name='tile_designation' base-type='uint32_t'> bay12: DESIGNATION_*
        <flag-bit name='flow_size' count='3' comment='liquid amount'/>
        <flag-bit name='pile' comment='stockpile; Adventure: lit'/>
        <flag-bit name='dig' count='3' type-name='tile_dig_designation' comment='Adventure: line_of_sight, furniture_memory, item_memory'/>
        <flag-bit name='smooth' count='2' comment='Adventure: creature_memory, original_cave'/>
        <flag-bit name='hidden'/>

        <flag-bit name='geolayer_index' count='4'/>
        <flag-bit name='light'/>
        <flag-bit name='subterranean'/>
        <flag-bit name='outside'/>
        <flag-bit name='biome' count='4'/>

        <flag-bit name='liquid_type' type-name='tile_liquid'/>

        <flag-bit name='water_table' comment='aquifer'/>
        <flag-bit name='rained'/>

        <flag-bit name='traffic' count='2' type-name='tile_traffic'/>

        <flag-bit name='flow_forbid'/>
        <flag-bit name='liquid_static'/>
        <flag-bit name='feature_local'/>
        <flag-bit name='feature_global'/>
        <flag-bit name='water_stagnant'/>
        <flag-bit name='water_salt'/>
    </bitfield-type>

    <enum-type type-name='tile_building_occ' base-type='uint32_t'> bay12: BUILDING_OCCUPANCY_*
        <enum-item name='None' comment='no building'/>
        <enum-item name='Planned' comment='CONST; nothing built yet'/>
        <enum-item name='Passable' comment='NO_BLOCK'/>
        <enum-item name='Obstacle' comment='BLOCK_FLOOR'/>
        <enum-item name='Well' comment='BLOCK'/>
        <enum-item name='Floored' comment='FLOOR; depot; lowered bridge'/>
        <enum-item name='Impassable' comment='TOTAL'/>
        <enum-item name='Dynamic' comment='SPECIAL; doors, grates, etc'/>
    </enum-type>

    <bitfield-type type-name='tile_occupancy' base-type='uint32_t'> bay12: OCCUPANCY_*
        <flag-bit name='building' count='3' type-name='tile_building_occ'/>
        <flag-bit name='unit' comment='standing'/>
        <flag-bit name='unit_grounded' comment='prone'/>
        <flag-bit name='item'/>
        <flag-bit name='edge_flow_in'
                  comment='if set on an edge tile, water or magma will flow in'/>
        <flag-bit name='moss'/>
        <flag-bit name='arrow_color' count='4'/>
        <flag-bit name='arrow_variant'/>
        <flag-bit name='unhide_trigger'
                  comment='when noncitizen moves in, something happens and it is cleared'/>
        <flag-bit name='monster_lair'
                  comment='bay12: permanent_mess; A monster lair. Items placed wont be moved.'/>
        <flag-bit name='no_grow'
                  comment='seems to be set on terrain tiles where grass growth is impossible'/>
        <flag-bit name='forced_subterranean_constructions'/>
        <flag-bit name='subterranean_light_column'/>
        <flag-bit name='carve_track_north'/>
        <flag-bit name='carve_track_south'/>
        <flag-bit name='carve_track_east'/>
        <flag-bit name='carve_track_west'/>
        <flag-bit name='spoor'/>
        <flag-bit name='eerie_light'/>
        <flag-bit name='dig_marked'/>
        <flag-bit name='dig_auto'/>
        <flag-bit name='heavy_aquifer' since='v0.47.01' comment="Light/Heavy aquifer flag"/>
        <flag-bit name='temp_value' comment='bay12: currently used by location calcs'/>
    </bitfield-type>

    <bitfield-type type-name='block_flags' base-type='uint32_t'> bay12: BLOCKFLAG_*
        <flag-bit name='designated' comment='for jobs etc'/>
        <flag-bit name='update_temperature'/>
        <flag-bit name='update_liquid'/>
        <flag-bit name='update_liquid_twice'
                  comment='Protects UpdateLiquid from being cleared the first time.'/>
        <flag-bit name='repath_on_freeze'
                  comment='reindex_pathfinding set and flag cleared if temperature below 10000'/>
        <flag-bit name='repath_on_melt'
                  comment='reindex_pathfinding set and flag cleared if temperature above 10000'/>
        <flag-bit name='has_aquifer'
                  comment='has at least one "water_table" designation flag'/>
        <flag-bit name='check_aquifer'
                  comment='bay12: NEARBY_WATER_TABLE; has tiles that may get flooded by an adjacent aquifer'/>
        <flag-bit name='may_have_item_spatter'/>
        <flag-bit name='may_have_material_spatter' comment="usually mud"/>
        <flag-bit name='has_magma_close'/>
        <flag-bit name='has_magma_far'/>
        <flag-bit name='mas_magma_low'/>
        <flag-bit name='has_river_high'/>
        <flag-bit name='has_river_medium'/>
        <flag-bit name='has_river_low'/>
    </bitfield-type>

    <bitfield-type type-name='z_level_flags'> bay12: TEMP_BLOCK_FLAG_*
        <flag-bit name='update'/> bay12: ADJUSTMENTS
        <flag-bit name='can_stop'/> bay12: REMOVE_ADJUSTMENTS_FLAGS
        <flag-bit name='update_twice'/> bay12: STOP_REMOVE_ADJUSTMENTS_FLAG
    </bitfield-type>

    <enum-type type-name='tile_liquid_temp_flow_dir' base-type='uint16_t'> bay12: FLOW_DIR_TEMP_DIR_*
        <enum-item name='north'/>
        <enum-item name='south'/>
        <enum-item name='east'/>
        <enum-item name='northeast'/>
        <enum-item name='west'/>
        <enum-item name='northwest'/>
        <enum-item name='southeast'/>
        <enum-item name='southwest'/>
    </enum-type>

    <enum-type type-name='tile_liquid_flow_dir' base-type='uint16_t'> bay12: FLOW_DIR_SINK_DIR_*
        <enum-item name='inactive'/>
        <enum-item name='south'/>
        <enum-item name='east'/>
        <enum-item name='northeast'/>
        <enum-item name='west'/>
        <enum-item name='northwest'/>
        <enum-item name='southeast'/>
        <enum-item name='southwest'/>
        <enum-item name='down'/>
        <enum-item name='none'/>
        <enum-item name='north'/>
    </enum-type>

    <bitfield-type type-name='tile_liquid_flow' base-type='uint16_t'> bay12: FLOW_DIR_*
        <flag-bit name='temp_flow_timer' count='3' comment='set when water sloshes around, counts down to zero'/>
        <flag-bit name='temp_dir' count='3' type-name='tile_liquid_temp_flow_dir'/>
        <flag-bit name='perm_flow_dir' count='4' type-name='tile_liquid_flow_dir'/>
        <flag-bit name='sink_dist' count='6' comment='periodically set whenever perm_flow_dir is nonzero'/>
    </bitfield-type>

    <struct-type type-name='tile_bitmask' custom-methods='true' comment='not in DF, 16x16 bitmask'>
        <static-array name='bits' count='16' type-name='uint16_t'/>
        <custom-methods>
            <cmethod name='clear'/>
            <cmethod name='set_all'/>
            <cmethod name='has_assignments'/>
        </custom-methods>
    </struct-type>

    <struct-type type-name='block_burrow' original-name='burrow_blockst' df-list-link-type='block_burrow_link' df-list-link-field='link' custom-methods='true'>
        <int32_t name='id' ref-target='burrow'/>

        <compound name='tile_bitmask' type-name='tile_bitmask'/>

        <pointer name="link" type-name='block_burrow_link'/>

        <custom-methods>
            <cmethod name='has_assignments'/>
        </custom-methods>
    </struct-type>

    <df-linked-list-type type-name='block_burrow_link' item-type='block_burrow'/> bay12: tlink{burrow_blockst}

    <struct-type type-name='map_block' original-name='blockst'>
        <bitfield name='flags' type-name='block_flags'/>

        <stl-vector name='block_events' pointer-type='block_square_event'/>

        <df-linked-list name='block_burrows' type-name='block_burrow_link'/>

        <int32_t name='local_feature' init-value='-1' comment='index into world_data.region_map'/>
        <int32_t name='global_feature' ref-target='world_underground_region'/>
        <int32_t name='global_feature_sq' init-value='-1'/>

        This is compared to unit.animal.population.depth when a revealed
        necromancer searches for a map edge tile to run away to:
        <int16_t name='layer_depth' comment='uninitialized'/>

        <int32_t name='dsgn_check_cooldown'/>
        <bitfield type-name='tile_designation' name='default_liquid'/>

        <stl-vector name='items' type-name='int32_t' ref-target='item'/>
        <stl-vector name='flows' pointer-type='flow_info'/>

        <compound name='flow_pool' type-name='flow_reuse_pool' comment='actually inline'/>

        <compound name='map_pos' type-name='coord'/>
        <compound name='region_pos' type-name='coord2d'/>

        <static-array name='tiletype' count='16'>
            <static-array count='16'>
                <enum base-type='uint16_t' type-name='tiletype' init-value='OpenSpace'/>
            </static-array>
        </static-array>
        <static-array name='designation' count='16'>
            <static-array count='16'>
                <bitfield type-name='tile_designation'/>
            </static-array>
        </static-array>
        <static-array name='occupancy' count='16'>
            <static-array count='16'>
                <bitfield type-name='tile_occupancy'/>
            </static-array>
        </static-array>

        <static-array name='fog_of_war' count='16' comment='bay12: memmap; for adventure mode'>
            <static-array count='16' type-name='uint8_t'/>
        </static-array>

        <static-array name='path_cost' count='16' comment='bay12: pmap'>
            <comment>flood; 256*cost for straight, 362*cost for diagonal</comment>
            <static-array count='16'>
                <int32_t/>
            </static-array>
        </static-array>
        <static-array name='path_tag' count='16' comment='bay12: dirmap'>
            <comment>flood; sync to path_distance; same value; inc per run; reset to 0 on wraparound</comment>
            <static-array count='16'>
                <uint16_t/>
            </static-array>
        </static-array>
        <static-array name='walkable' count='16' comment='bay12: levelmap'>
            <comment>0 = non-walkable; same nonzero at A and B = walkable from A to B</comment>
            <static-array count='16'>
                <int16_t/>
            </static-array>
        </static-array>
        <static-array name='map_edge_distance' count='16' comment='bay12: dlevelmap'>
            <comment>1 at walkable map edge; then +1 per 10 tiles it seems; 0 in dug tunnels</comment>
            <static-array count='16'>
                <int16_t/>
            </static-array>
        </static-array>

        <static-array name='temperature_1' count='16' comment='bay12: current_temperature'>
            <static-array count='16'>
                <uint16_t/>
            </static-array>
        </static-array>
        <static-array name='temperature_2' count='16' comment='bay12: normal_temperature'>
            <static-array count='16'>
                <uint16_t/>
            </static-array>
        </static-array>

        <static-array name='lighting' count='16'>
            <static-array count='16'>
                <uint16_t/>
            </static-array>
        </static-array>
        <static-array name='liquid_flow' count='16'>
            <static-array count='16'>
                <bitfield type-name='tile_liquid_flow'/>
            </static-array>
        </static-array>

        <static-array name='region_offset' count='9'>
            <int8_t/>
        </static-array>
    </struct-type>

    <df-linked-list-type type-name='cave_column_link' item-type='cave_column'/>

    <class-type type-name='cave_column' df-list-link-type='cave_column_link' df-list-link-field='' original-name='cave_columnst'>
        <int16_t name='base_z'/>
        <int16_t name='top_z'/>
        <uint16_t name='rect_index' init-value='30000'/>
        <bitfield name='flags' base-type='uint8_t'> bay12: CAVE_COLUMN_FLAG_*
            <flag-bit name='UNSTABLE'/>
            <flag-bit name='ULTRA_SUPPORTED'/>
        </bitfield>

        <virtual-methods>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
        </virtual-methods>
    </class-type>

    <class-type type-name='cave_column_rectangle' original-name='cave_column_rectanglest'>
        <int32_t name='weight'/>
        <int16_t name='min_x'/>
        <int16_t name='min_y'/>
        <int16_t name='max_x'/>
        <int16_t name='max_y'/>
        <int16_t name='base_z'/>
        <stl-vector type-name='int16_t' name='neighbor_bx'/>
        <stl-vector type-name='int16_t' name='neighbor_by'/>
        <stl-vector type-name='uint16_t' name='neighbor_index'/>
        <bitfield name='flags' base-type='uint32_t'> bay12: CAVE_COLUMN_RECTANGLE_FLAG_*
            <flag-bit name='SUPPORTED'/>
            <flag-bit name='UNSTABLE'/>
            <flag-bit name='ULTRA_SUPPORTED'/>
        </bitfield>

        <virtual-methods>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
        </virtual-methods>
    </class-type>

    <enum-type type-name='map_block_column_flags'> bay12: BlockColumnFlagType
        <enum-item name='UPDATE_CAVE_COLUMNS'/>
    </enum-type>

    <struct-type type-name='map_block_column' original-name='block_columnst'>
        <int16_t name="sink_level" comment='bay12: water_el_table_block; water at or above this level sinks into aquifer tiles'/>
        <int16_t name="beach_level" comment='bay12: water_el_sink_height; water at this level disappears if above more water'/>

        <int16_t name='ground_level' comment='bay12: central_el_z; for coloring unallocated blocks'/>

        <stl-vector name='unmined_glyphs'>
            <pointer> bay12: block_column_print_infost
                <static-array name='x' count='4' type-name='int16_t'/>
                <static-array name='y' count='4' type-name='int16_t'/>
                <static-array name='tile' count='4' type-name='uint8_t'/>
            </pointer>
        </stl-vector>

        <int16_t name="z_base"/>

        <static-array name='cave_columns' count='16'>
            <static-array count='16'>
                <df-linked-list type-name='cave_column_link'/>
            </static-array>
        </static-array>

        <stl-vector name='column_rectangles' pointer-type='cave_column_rectangle'/>

        <int16_t name='z_shift' comment='seems to be 0 originally, but updated when map is shifted'/>

        <df-flagarray name='flags' index-enum='map_block_column_flags'/>

        <static-array name='elevation' count='16' since='v0.40.01'>
            <static-array count='16' type-name='int16_t' init-value='100'/>
        </static-array>

        <compound name='map_pos' type-name='coord' comment='top left in tiles'/>
        <compound name='region_pos' type-name='coord2d'/>

        <stl-vector name='plants' pointer-type='plant' comment="Only populated for the top left column in each mid level tile"/>
    </struct-type>

    <enum-type type-name='block_square_event_type' base-type='int16_t'> bay12: BlockSquareEventType
        <enum-item name='mineral'/>
        <enum-item name='frozen_liquid'/>
        <enum-item name='world_construction'/>
        <enum-item name='material_spatter'/>
        <enum-item name='grass'/>
        <enum-item name='spoor'/>
        <enum-item name='item_spatter'/>
        <enum-item name='designation_priority'/>
    </enum-type>

    <class-type type-name='block_square_event' original-name='block_square_eventst'>
        <virtual-methods>
            <vmethod ret-type='block_square_event_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod ret-type='bool' name='isEmpty'/>
            <vmethod is-destructor='true'/>

            <vmethod name='checkTemperature'>
                <int16_t name='x'/>
                <int16_t name='y'/>
                <uint16_t name='temperature'/>
            </vmethod>
        </virtual-methods>
    </class-type>

    <class-type type-name='block_square_event_mineralst' inherits-from='block_square_event' custom-methods='true'>
        <int32_t name='inorganic_mat' ref-target='inorganic_raw'/>
        <compound name='tile_bitmask' type-name='tile_bitmask'/>
        <bitfield name='flags' base-type='uint32_t'> bay12: MINERAL_EVENT_FLAG_*
            <flag-bit name='discovered'/>
            <flag-bit name='cluster'/>
            <flag-bit name='vein'/>
            <flag-bit name='cluster_small'/>
            <flag-bit name='cluster_one'/>
        </bitfield>
        <custom-methods>
            <cmethod name='has_assignments'/>
        </custom-methods>
    </class-type>

    <class-type type-name='block_square_event_frozen_liquidst' inherits-from='block_square_event'>
        <static-array name='tiles' count='16'>
            <static-array count='16'>
                <enum base-type='uint16_t' type-name='tiletype'/>
            </static-array>
        </static-array>
        <static-array name='liquid_type' count='16'>
            <static-array count='16'>
                <enum base-type='uint8_t' type-name='tile_liquid'/>
            </static-array>
        </static-array>
    </class-type>

    <class-type type-name='block_square_event_world_constructionst' inherits-from='block_square_event'>
        <int32_t name='construction_id' ref-target='world_construction'/>
        <compound name='tile_bitmask' type-name='tile_bitmask'/>
    </class-type>

    <class-type type-name='block_square_event_material_spatterst' inherits-from='block_square_event'>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <enum name='mat_state' type-name='matter_state'/>
        <static-array name='amount' count='16'>
            <static-array count='16' type-name='uint8_t'/>
        </static-array>
        <uint16_t name='min_temperature'/>
        <uint16_t name='max_temperature'/>
    </class-type>

    <class-type type-name='block_square_event_grassst' inherits-from='block_square_event'>
        <int32_t name='plant_index' ref-target='plant_raw' />
        <static-array name='amount' count='16'>
            <static-array count='16' type-name='uint8_t'/>
        </static-array>
    </class-type>

    <bitfield-type type-name='spoor_flag' base-type='uint16_t'> bay12: BSE_SPOOR_FLAG_*
        <flag-bit name='present'/>
        <flag-bit name='has_direction'/>
        <flag-bit name='direction' count='3' type-name='spoor_flag_dir'/>
        <flag-bit name='yours'/>
        <flag-bit name='liquid_print'/>
        <flag-bit name='level' count='2' type-name='spoor_flag_level'/>
    </bitfield-type>

    <enum-type type-name='spoor_flag_dir' base-type='uint16_t'> bay12: BSE_SPOOR_FLAG_DIR_*
        <enum-item name='north'/>
        <enum-item name='south'/>
        <enum-item name='east'/>
        <enum-item name='northeast'/>
        <enum-item name='west'/>
        <enum-item name='northwest'/>
        <enum-item name='southeast'/>
        <enum-item name='southwest'/>
    </enum-type>

    <enum-type type-name='spoor_flag_level' base-type='uint16_t'> bay12: BSE_SPOOR_FLAG_LEVEL_*
        <enum-item name='normal'/>
        <enum-item name='vague'/>
        <enum-item name='light'/>
        <enum-item name='heavy'/>
    </enum-type>

    <enum-type type-name='spoor_type' base-type='int8_t'> bay12: BSESpoorType, defined as Uint8_t but that won't work here
        <enum-item name='NONE' value='-1'/>
        <enum-item name='BROKEN_VEGETATION'/>
        <enum-item name='HFID_COMBINEDCASTE_BP'/>
        <enum-item name='ITEMT_ITEMST_ORIENT'/>
        <enum-item name='MESS'/>
    </enum-type>

    <class-type type-name='block_square_event_spoorst' inherits-from='block_square_event'>
        bay12: block_square_event_spoor_infost
        <static-array name='flags' count='16'>
            <static-array count='16' type-name='spoor_flag'>
            </static-array>
        </static-array>
        <static-array name='type' count='16'>
            <static-array count='16' type-name='spoor_type'/>
        </static-array>
        <static-array name='id1' count='16'>
            <static-array count='16'>
                <int32_t/>
            </static-array>
        </static-array>
        <static-array name='race' count='16' comment='bay12: id2, varies based on type'>
            <static-array count='16'>
                <int32_t ref-target='creature_raw'/>
            </static-array>
        </static-array>
        <static-array name='caste' count='16' comment='bay12: id3, varies based on type'>
            <static-array count='16'>
                <int32_t ref-target='caste_raw'/>
            </static-array>
        </static-array>
        <static-array name='age' count='16' comment='in half-seconds'>
            <static-array count='16' type-name='int32_t'/>
        </static-array>
        <int32_t name='year' init-value='-1'/>
        <int32_t name='year_tick' init-value='-1'/>
    </class-type>

    <bitfield-type type-name='item_spatter_flag' base-type='uint8_t'> bay12: BLOCK_SQUARE_EVENT_ITEM_SPATTER_FLAG_*
        <flag-bit name='season_full_timer' count='3'/>
    </bitfield-type>

    <class-type type-name='block_square_event_item_spatterst' inherits-from='block_square_event'>
        <enum name='item_type' type-name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mattype' ref-target='material' aux-value='$$.matindex'/>
        <int32_t name='matindex'/>

        <int32_t name='print_variant'/>
        <static-array name='amount' count='16'>
            <static-array count='16' type-name='int32_t'/>
        </static-array>
        <static-array name='flag' count='16'>
            <static-array count='16' type-name='item_spatter_flag'/>
        </static-array>

        <uint16_t name='min_temperature'/>
        <uint16_t name='max_temperature'/>
    </class-type>

    <class-type type-name='block_square_event_designation_priorityst' inherits-from='block_square_event'>
        <static-array name='priority' count='16'>
            <static-array count='16' type-name='int32_t'/>
        </static-array>
    </class-type>

    <enum-type type-name='feature_type' base-type='int16_t'> bay12: FeatureType
        <enum-item name='outdoor_river'/>
        <enum-item name='cave'/>
        <enum-item name='pit'/>
        <enum-item name='magma_pool'/>
        <enum-item name='volcano'/>
        <enum-item name='deep_special_tube'/>
        <enum-item name='deep_surface_portal'/>
        <enum-item name='subterranean_from_layer'/>
        <enum-item name='magma_core_from_layer'/>
        <enum-item name='underworld_from_layer'/>
    </enum-type>

    <class-type type-name='feature' original-name='featurest'>
        <stl-vector name='population' pointer-type='world_population'/>

        <int32_t name='irritation_level' comment='divide by 10k for attack chance, max 100k'/>
        <int16_t name='irritation_attacks' comment='maxes at 10?'/>

        <compound name='embark_pos' type-name='coord2d_path'/>
        <stl-vector name='min_map_z' type-name='int16_t'/>
        <stl-vector name='max_map_z' type-name='int16_t'/>

        <virtual-methods>
            <vmethod ret-type='feature_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod name='shiftCoords'><int16_t name='x'/><int16_t name='y'/><int16_t name='z'/></vmethod>
            <vmethod name='discovery_realize' comment='originally used in 40d to populate demon pits'/>

            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='feature_outdoor_riverst' inherits-from='feature'/>
    <class-type type-name='feature_cavest' inherits-from='feature'/>
    <class-type type-name='feature_pitst' inherits-from='feature'/>
    <class-type type-name='feature_magma_poolst' inherits-from='feature'>
        <int32_t name='magma_fill_z'/>
    </class-type>
    <class-type type-name='feature_volcanost' inherits-from='feature'>
        <int32_t name='magma_fill_z'/>
    </class-type>
    <class-type type-name='feature_deep_special_tubest' inherits-from='feature'/>
    <class-type type-name='feature_deep_surface_portalst' inherits-from='feature'/>
    <class-type type-name='feature_subterranean_from_layerst' inherits-from='feature'/>
    <class-type type-name='feature_magma_core_from_layerst' inherits-from='feature'/>
    <class-type type-name='feature_underworld_from_layerst' inherits-from='feature'/>

    <enum-type type-name='feature_init_flags'> bay12: FeatureInitFlagType
        <enum-item name='AddSavage'/>
        <enum-item name='AddEvil'/>
        <enum-item name='AddGood'/>
        <enum-item name='Discovered'/>
        <enum-item name='Announced'/>
        <enum-item name='AnnouncedFully' comment='for tube inside vs. outside'/>
    </enum-type>

    <enum-type type-name='layer_type' base-type='int16_t'>
        <enum-item name='Surface' value='-1'/>
        <enum-item name='Cavern1'/>
        <enum-item name='Cavern2'/>
        <enum-item name='Cavern3'/>
        <enum-item name='MagmaSea'/>
        <enum-item name='Underworld'/>
    </enum-type>

    <class-type type-name='feature_init' original-name='feature_initst'>
        <df-flagarray name='flags' index-enum='feature_init_flags'/>
        <stl-vector name='alterations' pointer-type='feature_alteration'/>
        <int16_t name='start_x'/>
        <int16_t name='start_y'/>
        <int16_t name='end_x'/>
        <int16_t name='end_y'/>
        <enum name='start_depth' type-name='layer_type' base-type='int16_t'/>
        <enum name='end_depth' type-name='layer_type' base-type='int16_t'/>

        <virtual-methods>
            <vmethod ret-type='feature_type' name='getType'/>
            <vmethod name='write_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <bool name='include_feature'/>
            </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
                <bool name='include_feature'/>
            </vmethod>
            <vmethod name='createFeature' comment='for load'>
                <ret-type><pointer type-name='feature'/></ret-type>
            </vmethod>
            <vmethod name='recreateFeature' comment='destroyFeature(), then createFeature()'>
                <ret-type><pointer type-name='feature'/></ret-type>
            </vmethod>

            <vmethod name='destroyFeature'/>
            <vmethod name='getFeature'>
                <ret-type><pointer type-name='feature'/></ret-type>
            </vmethod>
            <vmethod is-destructor='true'/>
            <vmethod name='getMaterial'>
                <pointer name='mat_type' type-name='int16_t'/>
                <pointer name='mat_index' type-name='int32_t'/>
            </vmethod>
            <vmethod ret-type='bool' name='generates_river_vermin'/>

            <vmethod ret-type='bool' name='outdoor_wildlife_feature'/>
            <vmethod ret-type='bool' name='indoor_wildlife_feature'/>
            <vmethod ret-type='bool' name='fishing_feature'/>
            <vmethod name='getColor'>
                <pointer name='foreground' type-name='int16_t'/>
                <pointer name='background' type-name='int16_t'/>
                <pointer name='bright' type-name='int8_t'/>
            </vmethod>
            <vmethod name='getName'>
                <pointer name='name' type-name='stl-string'/>
            </vmethod>

            <vmethod name='isWater' ret-type='bool'/>
            <vmethod name='isSubterranean' ret-type='bool'/>
            <vmethod name='isMagma' ret-type='bool'/>
            <vmethod name='isChasm' ret-type='bool'/>
            <vmethod name='isUnderworld' ret-type='bool'/>

            <vmethod ret-type='bool' name='isOutdoorRiver'/>
            <vmethod ret-type='int32_t' name='getLayer'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='feature_init_outdoor_riverst' inherits-from='feature_init'>
        <pointer name='feature' type-name='feature_outdoor_riverst'/>
    </class-type>

    <class-type type-name='feature_init_cavest' inherits-from='feature_init'>
        <pointer name='feature' type-name='feature_cavest'/>
    </class-type>

    <class-type type-name='feature_init_pitst' inherits-from='feature_init'>
        <pointer name='feature' type-name='feature_pitst'/>
    </class-type>

    <class-type type-name='feature_init_magma_poolst' inherits-from='feature_init'>
        <pointer name='feature' type-name='feature_magma_poolst'/>
    </class-type>

    <class-type type-name='feature_init_volcanost' inherits-from='feature_init'>
        <pointer name='feature' type-name='feature_volcanost'/>
    </class-type>

    <class-type type-name='feature_init_deep_special_tubest' inherits-from='feature_init'>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <pointer name='feature' type-name='feature_deep_special_tubest'/>
    </class-type>

    <class-type type-name='feature_init_deep_surface_portalst' inherits-from='feature_init'>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <pointer name='feature' type-name='feature_deep_surface_portalst'/>
    </class-type>

    <class-type type-name='feature_init_subterranean_from_layerst' inherits-from='feature_init'>
        <int32_t name='layer' ref-target='world_underground_region'/>
        <pointer name='feature' type-name='feature_subterranean_from_layerst'/>
    </class-type>

    <class-type type-name='feature_init_magma_core_from_layerst' inherits-from='feature_init'>
        <int32_t name='layer' ref-target='world_underground_region'/>
        <pointer name='feature' type-name='feature_magma_core_from_layerst'/>
    </class-type>

    <class-type type-name='feature_init_underworld_from_layerst' inherits-from='feature_init'>
        <int32_t name='layer' ref-target='world_underground_region'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <pointer name='feature' type-name='feature_underworld_from_layerst'/>
    </class-type>

    <enum-type type-name='feature_alteration_type' base-type='int16_t'> bay12: FeatureAlterationType
        <enum-item name='new_pop_max'/>
        <enum-item name='new_lava_fill_z'/>
    </enum-type>

    <class-type type-name='feature_alteration' original-name='feature_alterationst'>
        <virtual-methods>
            <vmethod ret-type='feature_alteration_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='feature_alteration_new_pop_maxst' inherits-from='feature_alteration'>
        <int32_t name='index'/>
        <int32_t name='new_num'/>
    </class-type>

    <class-type type-name='feature_alteration_new_lava_fill_zst' inherits-from='feature_alteration'>
        <int32_t name='magma_fill_z'/>
    </class-type>

    <enum-type type-name='world_construction_square_type' base-type='int16_t'> bay12: WorldConstructionSquareType
        <enum-item name='ROAD'/>
        <enum-item name='TUNNEL'/>
        <enum-item name='BRIDGE'/>
        <enum-item name='WALL'/>
    </enum-type>

    <class-type type-name='world_construction_square' original-name='world_construction_squarest'>
        <code-helper name='describe'> (describe-obj $.region_pos) </code-helper>

        <compound name='region_pos' type-name='coord2d'/>
        <int32_t name='construction_id' ref-target='world_construction'/>

        <stl-vector name='embark_x' type-name='int16_t'/>
        <stl-vector name='embark_y' type-name='int16_t'/>
        <stl-vector name='embark_exit' type-name='int16_t'/>
        <stl-vector name='embark_z' type-name='int16_t'/>

        <virtual-methods>
            <vmethod ret-type='world_construction_square_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='world_construction_square_roadst' inherits-from='world_construction_square'>
        <enum type-name='item_type' base-type='int16_t' name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
    </class-type>

    <class-type type-name='world_construction_square_tunnelst' inherits-from='world_construction_square'/>

    <class-type type-name='world_construction_square_bridgest' inherits-from='world_construction_square'>
        <int32_t name='road_id' ref-target='world_construction'/>
        <enum type-name='item_type' base-type='int16_t' name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
    </class-type>

    <class-type type-name='world_construction_square_wallst' inherits-from='world_construction_square'>
        <enum type-name='item_type' base-type='int16_t' name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
    </class-type>

    <enum-type type-name='world_construction_type' base-type='int16_t'> bay12: WorldConstructionType
        <enum-item name='ROAD'/>
        <enum-item name='TUNNEL'/>
        <enum-item name='BRIDGE'/>
        <enum-item name='WALL'/>
    </enum-type>

    <class-type type-name='world_construction' original-name='world_constructionst'
                instance-vector='$global.world.world_data.constructions.list' key-field='id'>
        <int32_t name='id'/>

        <stl-vector name='square_obj' pointer-type='world_construction_square'/>
        <compound name='square_pos' type-name='coord2d_path'/>

        <virtual-methods>
            <vmethod ret-type='world_construction_type' name='getType'/>
            <vmethod name='getName'><ret-type><pointer type-name='language_name'/></ret-type></vmethod>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='world_construction_roadst' inherits-from='world_construction'>
        <compound type-name='language_name' name='name'/>
    </class-type>

    <class-type type-name='world_construction_tunnelst' inherits-from='world_construction'>
        <compound type-name='language_name' name='name'/>
    </class-type>

    <class-type type-name='world_construction_bridgest' inherits-from='world_construction'>
        <compound type-name='language_name' name='name'/>
    </class-type>

    <class-type type-name='world_construction_wallst' inherits-from='world_construction'>
        <compound type-name='language_name' name='name'/>
    </class-type>

    <enum-type type-name='biome_type'> bay12: Biome, no base type
        <enum-attr name='caption'/>
        <enum-attr name='plant_raw_flag' type-name='plant_raw_flags' default-value='BIOME_SUBTERRANEAN_LAVA'/>

        <enum-item name='MOUNTAIN'>
            <item-attr name='caption' value='Mountain'/>
            <item-attr name='plant_raw_flag' value='BIOME_MOUNTAIN'/>
        </enum-item>
        <enum-item name='GLACIER'>
            <item-attr name='caption' value='Glacier'/>
            <item-attr name='plant_raw_flag' value='BIOME_GLACIER'/>
        </enum-item>
        <enum-item name='TUNDRA'>
            <item-attr name='caption' value='Tundra'/>
            <item-attr name='plant_raw_flag' value='BIOME_TUNDRA'/>
        </enum-item>
        <enum-item name='SWAMP_TEMPERATE_FRESHWATER'>
            <item-attr name='caption' value='Temperate Freshwater Swamp'/>
            <item-attr name='plant_raw_flag' value='BIOME_SWAMP_TEMPERATE_FRESHWATER'/>
        </enum-item>
        <enum-item name='SWAMP_TEMPERATE_SALTWATER'>
            <item-attr name='caption' value='Temperate Saltwater Swamp'/>
            <item-attr name='plant_raw_flag' value='BIOME_SWAMP_TEMPERATE_SALTWATER'/>
        </enum-item>
        <enum-item name='MARSH_TEMPERATE_FRESHWATER'>
            <item-attr name='caption' value='Temperate Freshwater Marsh'/>
            <item-attr name='plant_raw_flag' value='BIOME_MARSH_TEMPERATE_FRESHWATER'/>
        </enum-item>
        <enum-item name='MARSH_TEMPERATE_SALTWATER'>
            <item-attr name='caption' value='Temperate Saltwater Marsh'/>
            <item-attr name='plant_raw_flag' value='BIOME_MARSH_TEMPERATE_SALTWATER'/>
        </enum-item>
        <enum-item name='SWAMP_TROPICAL_FRESHWATER'>
            <item-attr name='caption' value='Tropical Freshwater Swamp'/>
            <item-attr name='plant_raw_flag' value='BIOME_SWAMP_TROPICAL_FRESHWATER'/>
        </enum-item>
        <enum-item name='SWAMP_TROPICAL_SALTWATER'>
            <item-attr name='caption' value='Tropical Saltwater Swamp'/>
            <item-attr name='plant_raw_flag' value='BIOME_SWAMP_TROPICAL_SALTWATER'/>
        </enum-item>
        <enum-item name='SWAMP_MANGROVE'>
            <item-attr name='caption' value='Mangrove Swamp'/>
            <item-attr name='plant_raw_flag' value='BIOME_SWAMP_MANGROVE'/>
        </enum-item>
        <enum-item name='MARSH_TROPICAL_FRESHWATER'>
            <item-attr name='caption' value='Tropical Freshwater Marsh'/>
            <item-attr name='plant_raw_flag' value='BIOME_MARSH_TROPICAL_FRESHWATER'/>
        </enum-item>
        <enum-item name='MARSH_TROPICAL_SALTWATER'>
            <item-attr name='caption' value='Tropical Saltwater Marsh'/>
            <item-attr name='plant_raw_flag' value='BIOME_MARSH_TROPICAL_SALTWATER'/>
        </enum-item>
        <enum-item name='FOREST_TAIGA'>
            <item-attr name='caption' value='Taiga Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TAIGA'/>
        </enum-item>
        <enum-item name='FOREST_TEMPERATE_CONIFER'>
            <item-attr name='caption' value='Temperate Conifer Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TEMPERATE_CONIFER'/>
        </enum-item>
        <enum-item name='FOREST_TEMPERATE_BROADLEAF'>
            <item-attr name='caption' value='Temperate Broadleaf Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TEMPERATE_BROADLEAF'/>
        </enum-item>
        <enum-item name='FOREST_TROPICAL_CONIFER'>
            <item-attr name='caption' value='Tropical Conifer Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TROPICAL_CONIFER'/>
        </enum-item>
        <enum-item name='FOREST_TROPICAL_DRY_BROADLEAF'>
            <item-attr name='caption' value='Tropical Dry Broadleaf Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TROPICAL_DRY_BROADLEAF'/>
        </enum-item>
        <enum-item name='FOREST_TROPICAL_MOIST_BROADLEAF'>
            <item-attr name='caption' value='Tropical Moist Broadleaf Forest'/>
            <item-attr name='plant_raw_flag' value='BIOME_FOREST_TROPICAL_MOIST_BROADLEAF'/>
        </enum-item>
        <enum-item name='GRASSLAND_TEMPERATE'>
            <item-attr name='caption' value='Temperate Grassland'/>
            <item-attr name='plant_raw_flag' value='BIOME_GRASSLAND_TEMPERATE'/>
        </enum-item>
        <enum-item name='SAVANNA_TEMPERATE'>
            <item-attr name='caption' value='Temperate Savanna'/>
            <item-attr name='plant_raw_flag' value='BIOME_SAVANNA_TEMPERATE'/>
        </enum-item>
        <enum-item name='SHRUBLAND_TEMPERATE'>
            <item-attr name='caption' value='Temperate Shrubland'/>
            <item-attr name='plant_raw_flag' value='BIOME_SHRUBLAND_TEMPERATE'/>
        </enum-item>
        <enum-item name='GRASSLAND_TROPICAL'>
            <item-attr name='caption' value='Tropical Grassland'/>
            <item-attr name='plant_raw_flag' value='BIOME_GRASSLAND_TROPICAL'/>
        </enum-item>
        <enum-item name='SAVANNA_TROPICAL'>
            <item-attr name='caption' value='Tropical Savanna'/>
            <item-attr name='plant_raw_flag' value='BIOME_SAVANNA_TROPICAL'/>
        </enum-item>
        <enum-item name='SHRUBLAND_TROPICAL'>
            <item-attr name='caption' value='Tropical Shrubland'/>
            <item-attr name='plant_raw_flag' value='BIOME_SHRUBLAND_TROPICAL'/>
        </enum-item>
        <enum-item name='DESERT_BADLAND'>
            <item-attr name='caption' value='Badland Desert'/>
            <item-attr name='plant_raw_flag' value='BIOME_DESERT_BADLAND'/>
        </enum-item>
        <enum-item name='DESERT_ROCK'>
            <item-attr name='caption' value='Rock Desert'/>
            <item-attr name='plant_raw_flag' value='BIOME_DESERT_ROCK'/>
        </enum-item>
        <enum-item name='DESERT_SAND'>
            <item-attr name='caption' value='Sand Desert'/>
            <item-attr name='plant_raw_flag' value='BIOME_DESERT_SAND'/>
        </enum-item>
        <enum-item name='OCEAN_TROPICAL'>
            <item-attr name='caption' value='Tropical Ocean'/>
            <item-attr name='plant_raw_flag' value='BIOME_OCEAN_TROPICAL'/>
        </enum-item>
        <enum-item name='OCEAN_TEMPERATE'>
            <item-attr name='caption' value='Temperate Ocean'/>
            <item-attr name='plant_raw_flag' value='BIOME_OCEAN_TEMPERATE'/>
        </enum-item>
        <enum-item name='OCEAN_ARCTIC'>
            <item-attr name='caption' value='Arctic Ocean'/>
            <item-attr name='plant_raw_flag' value='BIOME_OCEAN_ARCTIC'/>
        </enum-item>
        <enum-item name='POOL_TEMPERATE_FRESHWATER'>
            <item-attr name='caption' value='Temperate Freshwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TEMPERATE_FRESHWATER'/>
        </enum-item>
        <enum-item name='POOL_TEMPERATE_BRACKISHWATER'>
            <item-attr name='caption' value='Temperate Brackishwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TEMPERATE_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='POOL_TEMPERATE_SALTWATER'>
            <item-attr name='caption' value='Temperate Saltwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TEMPERATE_SALTWATER'/>
        </enum-item>
        <enum-item name='POOL_TROPICAL_FRESHWATER'>
            <item-attr name='caption' value='Tropical Freshwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TROPICAL_FRESHWATER'/>
        </enum-item>
        <enum-item name='POOL_TROPICAL_BRACKISHWATER'>
            <item-attr name='caption' value='Tropical Brackishwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TROPICAL_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='POOL_TROPICAL_SALTWATER'>
            <item-attr name='caption' value='Tropical Saltwater Pool'/>
            <item-attr name='plant_raw_flag' value='BIOME_POOL_TROPICAL_SALTWATER'/>
        </enum-item>
        <enum-item name='LAKE_TEMPERATE_FRESHWATER'>
            <item-attr name='caption' value='Temperate Freshwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TEMPERATE_FRESHWATER'/>
        </enum-item>
        <enum-item name='LAKE_TEMPERATE_BRACKISHWATER'>
            <item-attr name='caption' value='Temperate Brackishwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TEMPERATE_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='LAKE_TEMPERATE_SALTWATER'>
            <item-attr name='caption' value='Temperate Saltwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TEMPERATE_SALTWATER'/>
        </enum-item>
        <enum-item name='LAKE_TROPICAL_FRESHWATER'>
            <item-attr name='caption' value='Tropical Freshwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TROPICAL_FRESHWATER'/>
        </enum-item>
        <enum-item name='LAKE_TROPICAL_BRACKISHWATER'>
            <item-attr name='caption' value='Tropical Brackishwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TROPICAL_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='LAKE_TROPICAL_SALTWATER'>
            <item-attr name='caption' value='Tropical Saltwater Lake'/>
            <item-attr name='plant_raw_flag' value='BIOME_LAKE_TROPICAL_SALTWATER'/>
        </enum-item>
        <enum-item name='RIVER_TEMPERATE_FRESHWATER'>
            <item-attr name='caption' value='Temperate Freshwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TEMPERATE_FRESHWATER'/>
        </enum-item>
        <enum-item name='RIVER_TEMPERATE_BRACKISHWATER'>
            <item-attr name='caption' value='Temperate Brackishwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TEMPERATE_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='RIVER_TEMPERATE_SALTWATER'>
            <item-attr name='caption' value='Temperate Saltwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TEMPERATE_SALTWATER'/>
        </enum-item>
        <enum-item name='RIVER_TROPICAL_FRESHWATER'>
            <item-attr name='caption' value='Tropical Freshwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TROPICAL_FRESHWATER'/>
        </enum-item>
        <enum-item name='RIVER_TROPICAL_BRACKISHWATER'>
            <item-attr name='caption' value='Tropical Brackishwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TROPICAL_BRACKISHWATER'/>
        </enum-item>
        <enum-item name='RIVER_TROPICAL_SALTWATER'>
            <item-attr name='caption' value='Tropical Saltwater River'/>
            <item-attr name='plant_raw_flag' value='BIOME_RIVER_TROPICAL_SALTWATER'/>
        </enum-item>
        <enum-item name='SUBTERRANEAN_WATER'>
            <item-attr name='caption' value='Subterranean Water'/>
            <item-attr name='plant_raw_flag' value='BIOME_SUBTERRANEAN_WATER' comment='cavern plants'/>
        </enum-item>
        <enum-item name='SUBTERRANEAN_CHASM'>
            <item-attr name='caption' value='Subterranean Chasm'/>
            <item-attr name='plant_raw_flag' value='BIOME_SUBTERRANEAN_CHASM'/>
        </enum-item>
        <enum-item name='SUBTERRANEAN_LAVA'>
            <item-attr name='caption' value='Subterranean Lava'/>
            <item-attr name='plant_raw_flag' value='BIOME_SUBTERRANEAN_LAVA'/>
        </enum-item>
    </enum-type>

    <bitfield-type type-name='construction_flags' base-type='uint8_t'> bay12: EVENT_CONSTRUCTION_FLAG_*
        <flag-bit name='no_build_item' comment='bay12: MUST_GENERATE_ITEMS; build item is created from scratch upon removing construction, does not exist beforehand'/>
        <flag-bit name='top_of_wall' comment='bay12: ITEMLESS_CEILING; used on the floors above constructed walls so you cannot remove them'/>
    </bitfield-type>

    <struct-type type-name='construction' instance-vector='$global.world.constructions' key-field='pos' original-name='event_constructionst' custom-methods='true'>
        <compound name='pos' type-name='coord'/>
        <enum type-name='item_type' name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <bitfield type-name='construction_flags' name='flags'/>
        <enum base-type='uint16_t' type-name='tiletype' name='original_tile'/>
    </struct-type>

    <enum-type type-name='flow_type' base-type='int16_t'> bay12: FlowTypes, no base type
        <enum-item name='Miasma'/>
        <enum-item name='Steam' comment='bay12: MIST_WATER'/>
        <enum-item name='Mist' comment='bay12: MIST_WATERFALL'/>
        <enum-item name='MaterialDust'/>
        <enum-item name='MagmaMist'/>
        <enum-item name='Smoke'/>
        <enum-item name='Dragonfire'/>
        <enum-item name='Fire'/>
        <enum-item name='Web'/>
        <enum-item name='MaterialGas'/>
        <enum-item name='MaterialVapor'/>
        <enum-item name='OceanWave'/>
        <enum-item name='SeaFoam'/>
        <enum-item name='ItemCloud'/>
    </enum-type>

    <struct-type type-name='flow_info' original-name='event_flowst'>
        <enum type-name='flow_type' base-type='int16_t' name='type'/>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index' init-value='-1'/>
        <int16_t name='density'/>
        <compound name='pos' type-name='coord'/>
        <compound name='dest' type-name='coord'/>
        <bool name='expanding' init-value='1'/>
        <bitfield name='flags' base-type='uint8_t'> bay12: EVENTFLOW_FLAG_*
            <flag-bit name='DEAD'/>
            <flag-bit name='FAST'/>
            <flag-bit name='CREEPING'/>
        </bitfield>
        <int32_t name='guide_id' ref-target='flow_guide'/>
    </struct-type>

    <struct-type type-name='flow_reuse_pool' original-name='flow_trackerst'>
        <int32_t name='reuse_idx' init-value='-1'/>
        <bitfield name='flags' base-type='uint32_t'> bay12: FLOWTRACKER_FLAG_*
            <flag-bit name='active' comment='SOMETHINGDIED'/>
        </bitfield>
    </struct-type>

    <enum-type type-name='flow_guide_type' base-type='int16_t'> bay12: FlowGuideType
        <enum-item name='TrailingFlow'/>
        <enum-item name='ItemCloud'/>
    </enum-type>

    <class-type type-name='flow_guide' original-name='flow_guidest'
                key-field='id' instance-vector='$global.world.flow_guides.all'>
        <int32_t name='id'/>
        <bool name='tagged' comment='for culling'/>
        <virtual-methods>
            <vmethod ret-type='flow_guide_type' name='getType'/>
            <vmethod name='shiftCoords'><int16_t name='x'/><int16_t name='y'/><int16_t name='z'/></vmethod>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod name='advance_flow'><pointer type-name='flow_info'/></vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='flow_guide_trailing_flowst' inherits-from='flow_guide'>
        <static-array name='line' type-name='coord' count='15'/>
    </class-type>

    <class-type type-name='flow_guide_item_cloudst' inherits-from='flow_guide'>
        <enum name='item_type' type-name='item_type'/>
        <int16_t name='item_subtype' refers-to='(item-subtype-target $$._parent.item_type $)'/>
        <int16_t name='mattype' ref-target='material' aux-value='$$.matindex'/>
        <int32_t name='matindex'/>
        <int32_t name="print_variant"/>
        <bitfield name='flags' base-type='uint32_t'> bay12: FLOW_GUIDE_ITEM_CLOUD_FLAG_*
            <flag-bit name='undirected'/>
            <flag-bit name='trailing'/>
        </bitfield>
        <static-array name='line' type-name='coord' count='15'/>
    </class-type>

    <enum-type type-name='effect_type'> bay12: Effects, no base type
        <enum-item name='Sparkles'/>
        <enum-item name='Color'/>
        <enum-item name='ShrinkingDot'/>
    </enum-type>

    <struct-type type-name='effect_info' original-name='effectst'>
        <int32_t name='save_idx'/>
        <pointer name='job' type-name='job'/>
        <enum name='type' type-name='effect_type' base-type='int16_t'/>
        <int16_t name='foreground'/>
        <int16_t name='background'/>
        <int8_t name='bright'/>
        <compound type-name='coord' name='pos'/>
        <int32_t name='timer'/>
        <int32_t name='id'/>
    </struct-type>

    <enum-type type-name='region_block_event_type' base-type='int16_t'> bay12: RegionBlockEventType
        <enum-item name='SphereField'/>
    </enum-type>

    <class-type type-name='region_block_eventst'>
        <virtual-methods>
            <vmethod ret-type='region_block_event_type' name='getType'/>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>
            <vmethod name='isEmpty' ret-type='bool'/>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='region_block_event_sphere_fieldst' inherits-from='region_block_eventst'>
        <compound name='tile_bitmask' type-name='tile_bitmask'/>
    </class-type>

</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
