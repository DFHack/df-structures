<data-definition>
    <struct-type type-name='dye_info' comment='not actually a real structure'>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <int32_t name='dyer' ref-target='historical_figure'/>
        <enum base-type='int16_t' name='quality' type-name='item_quality'/>
        <enum base-type='int16_t' name="skill_rating" type-name='skill_rating'
              comment='at the moment of creation'/>
        <int32_t name='age_counter'/>
    </struct-type>

    <class-type type-name='itemimprovement' original-name='itemimprovementst'>
        <int16_t name='mat_type' ref-target='material' aux-value='$$.mat_index'/>
        <int32_t name='mat_index'/>
        <int32_t name='maker' ref-target='historical_figure'/>
        <int32_t name='masterpiece_event' ref-target='history_event'/>
        <enum base-type='int16_t' name='quality' type-name='item_quality'/>
        <enum base-type='int32_t' name="skill_rating" type-name='skill_rating'
              comment='at the moment of creation'/>
        <int32_t name='age_counter'/>

        <virtual-methods>
            <vmethod name='getImage'><pointer type-name='item'/>
                <ret-type><pointer type-name='art_image'/></ret-type>
            </vmethod>
            <vmethod name='getColorAndShape'>
                <pointer name='colors'><stl-vector type-name='int16_t'/></pointer>
                <pointer name='shapes'><stl-vector type-name='int16_t'/></pointer>
                <pointer name='item' type-name='item'/>
            </vmethod>
            <vmethod name='clone'>
                <ret-type><pointer type-name='itemimprovement'/></ret-type>
            </vmethod>
            <vmethod name='write_file'> <pointer name='file' type-name='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer name='file' type-name='file_compressorst'/>
                <enum name='loadversion' type-name='save_version'/>
            </vmethod>

            <vmethod ret-type='improvement_type' name='getType'/>
            <vmethod ret-type='bool' name='isDecoration' comment='displayed_improvement'/>
            <vmethod is-destructor='true'/>
            <vmethod ret-type='int32_t' name='getDyeValue'>
                <pointer type-name='caravan_state' name='caravan'/>
            </vmethod>
            <vmethod name='setShape'>
                <int32_t name='shape' ref-target='descriptor_shape'/>
            </vmethod>
        </virtual-methods>
    </class-type>

    <class-type type-name='itemimprovement_art_imagest' inherits-from='itemimprovement'>
        <compound name='image' type-name='art_image_ref'/>
    </class-type>

    <class-type type-name='itemimprovement_coveredst' inherits-from='itemimprovement'>
        <bitfield name='cover_flags' base-type='uint32_t'> bay12: ITEMIMPROVEMENT_COVERED_FLAG_*
            <flag-bit name='glazed'/>
        </bitfield>
        <int32_t name='shape' ref-target='descriptor_shape'/>
    </class-type>

    <class-type type-name='itemimprovement_rings_hangingst' inherits-from='itemimprovement'/>

    <class-type type-name='itemimprovement_bandsst' inherits-from='itemimprovement'>
        <int32_t name='shape' ref-target='descriptor_shape'/>
    </class-type>

    <class-type type-name='itemimprovement_spikesst' inherits-from='itemimprovement'/>

    <class-type type-name='itemimprovement_itemspecificst' inherits-from='itemimprovement'>
        <enum base-type='int32_t' type-name='itemimprovement_specific_type' name='type'/>
    </class-type>

    <class-type type-name='itemimprovement_threadst' inherits-from='itemimprovement'>
        <compound name='dye' type-name='dye_info'/>
    </class-type>

    <class-type type-name='itemimprovement_clothst' inherits-from='itemimprovement'/>

    <class-type type-name='itemimprovement_sewn_imagest' inherits-from='itemimprovement'>
        none of these are actual compounds - beware of potential alignment/padding issues
        <compound name='image' type-name='art_image_ref'/>
        <compound name='cloth'>
            <int32_t name='maker_hf' ref-target='historical_figure'/>
            <int16_t name='quality'/>
            <int16_t name='skill_rating'/>
        </compound>
        <compound name='dye' type-name='dye_info'/>
    </class-type>

    <class-type type-name='itemimprovement_pagesst' inherits-from='itemimprovement'>
        <int32_t name='count'/>
        <stl-vector name='contents' type-name='int32_t' ref-target='written_content'/>
    </class-type>

    <class-type type-name='itemimprovement_illustrationst' inherits-from='itemimprovement'>
        <compound name='image' type-name='art_image_ref'/>
        <int32_t name='page_number' since='v0.34.01'/> bay12: III_PAGE_* for several special negative values
    </class-type>

    <class-type type-name='itemimprovement_instrument_piecest' inherits-from='itemimprovement'>
        <stl-string name='type' comment='instrument_piece.type'/>
    </class-type>

    <class-type type-name='itemimprovement_writingst' inherits-from='itemimprovement'>
        <stl-vector name='contents' type-name='int32_t' ref-target='written_content'/>
    </class-type>

    <class-type type-name='itemimprovement_image_setst' inherits-from='itemimprovement'>
        <int32_t name='image_set_id' init-value='-1' ref-target='image_set'/>
    </class-type>

    <struct-type type-name='written_content' original-name='written_contentst' instance-vector='$global.world.written_contents.all' key-field='id'>
        <int32_t name='id'/>
        <stl-string name='title'/>
        <int32_t name='page_start'/>
        <int32_t name='page_end'/>
        <stl-vector name='refs' pointer-type='general_ref' comment='interactions learned'/>
        <stl-vector name='ref_aux' type-name='writing_role_type'/>
        <int32_t name='chapter_number' init-value='-1'/>
        <int32_t name='section_number' init-value='-1'/>
        <enum type-name='written_content_type' name='type'/>
        <int32_t name='poetic_form' since='v0.42.01' ref-target='poetic_form' comment='or musical composition or dance'/>
        <stl-vector name='styles' type-name='written_content_style'/>
        <stl-vector name='style_strength' type-name='writing_style_modifier_type'/>
        <int32_t name='author' ref-target='historical_figure'/>
        <int32_t name='author_roll' init-value='-1' comment='skill roll for quality'/>
    </struct-type>

</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
