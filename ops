{"version":1,"ops":[{"type":1,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1516457715,"metadata":{"github-id":"MDU6SXNzdWUyOTAxOTUxNTE=","github-url":"https://github.com/DFHack/df-structures/issues/239","origin":"github"},"title":"Update df.unit_thoughts.xml:unit_thought_type and df.units.xml:emotion_type data","message":"The structure of this info has a rather quirky layout where emotion_type contains a couple of general purpose fields and unit_thought_type sort of hints at what text some field or other may result in.\nThere's a need to fill in additional info, such as what field are used for which thoughts, as well as what the types of those fields are, and the current structure isn't very suitable for that.\n\nI can see a few different alternatives for restructuring:\n\n1. Converting emotion_type into a base type where each thought has a derived type. In this scenario you'd e.g. get something like:\nemotion_type_needsunfulfilledst containing the fields \"need\" of the type df.need_type and \"hfid\" of a general integer type with the comment that it only applies to PrayOrMeditate.\nand\nemotion_type_spousegavebirthst containing the fields \"offspring_count\" of an integer type and \"relation\" of a new enum type containing the values \"married\" = 1, \"sibling\" = 11, \"parent\" = 12 (although it might be better to have a more general relation type containing \"spouse\" = 1, \"mother\" = 2, \"father\" = 3, \"lover\" = 9, \"sibling\" = 11, \"child\" = 12, \"friend\" = 13, \"still annoying acquaintance\" = 14, and \"animal training partner\" = 18 [with pet=0 removed, as it doesn't seem to work anymore], with the comment that only those 3 values are used).\n\nThe captions of unit_thought_type would be moved into these derived types.\nGiven the size of the results, emotion_type, its derived types, and the contents of df.unit_thoughts.xml should probably be moved into a new df.unit_emotion.xml file.\n\n2. Make a really messy union out of emotion type, where you'd end up with the fields\n- subthought (the current field unchanged)\n- subthought_need of the df.need_type type as a union overload/alias of subthought\n- subthought_relation of the enum type above as a union overload/alias\n- severity (the current field unchanged)\n- severity_hfid as an integer field union overload/alias of severity\n- severity_child_count, an integer field as an overload/alias of severity\nplus a bazillion others to cover the various usages (although you may skip union overload/alias fields where the type is an integer anyway, and just use the base fields in those cases).\nThe unit_thought_type caption texts would be changed to name the parameters they're using, rather than indicating the topic of the resultant text, and any descriptions on how to get those texts would be added as additional comments and possibly enum types with captions.\n\n3. As 2, but skip the union mess in emotion_type, and instead have the caption parameters refer to either subthought or severity, and comments mention the types to be used for field interpretation.\n\n4. All the alternatives I haven't seen, which may very well include the good ones.\n\nI've done a fair bit of work mapping out the various combinations, but there's still work remaining to be done (not to mention that my script/note is a rather messy work in progress). I wanted to start a discussion to hopefully get some kind of resolution, rather than go though a pull request containing an implementation, only to have to rework it all when the discussion ends up resulting in a different structure.","files":null}]}