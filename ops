{"version":1,"ops":[{"type":1,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1530362055,"metadata":{"github-id":"MDU6SXNzdWUzMzcyMTE3MDc=","github-url":"https://github.com/DFHack/df-structures/issues/284","origin":"github"},"title":"Performance incident related investigation","message":"I'm using this incident as public research notes intended to eventually lead to a pull request for an update of structures.\n\n- Musical performances can generate sing/speak/chant (I haven't generated any other). As far as I can tell this is controlled by musical_form.anon_4[*].anon_1 when .instrument_type is -1:\n  - bit 0 = Sing (1, 3, 5, 7, 9, 11)\n  - bit 1 = Speak (0, 2, 8, 10)\n  - bit 2 = Chant (4, 6, 12)\n  presumably only one of the bits is set at a time when generated by DF (the numbers are placed at the bit whose text was displayed as a dorf thought when the numbers were hacked in. I stopped at 12). Also, the field ought to be used to describe how \"actual\" instruments should be played, although I haven't investigated that.\n- musical_form.anon_4[*].anon_3 or .anon_4 should be the number of that kind of instruments. It might well be that anon_3 is the minimum number and anon_4 is the maximum, but that's just a guess based on seeing the numbers either being the same or anon_4 being larger than anon_3 (and both being the same and matching what DF describes in the case examined).\n- musical_form.anon_4 ought to change name to e.g. \"instruments\" as it was basically identified when the type of its contents was determined.\n- activity_event_performanst.poem was observed to be set with a music activity and to refer to the same written content music as the incident referenced (which also matches the one displayed in dwarf thoughts). Thus, the field ought to be renamed to e.g. \"written_content\". As I've seen incident story references to written contents I expect stories and dances can reference books as well.\n- incident.unk_v42_1.t6_performance.participants[*].anon_1 is probably performance_event_type, which is redundant if seen as part of the whole structure, but makes the vector elements self contained from a type dependency perpective.\n- incident.unk_v42_1.t6_performance.participants[*].anon_2 ought to be an instrument reference into musical_form.anon_4 as in activity_event_performancest.participant_actions.sub_type for music (although I suspect the comment there is slightly off, since there is music without any vocal part: it's just that the lead vocal part happens to appear first.\n- There should be something that distinguishes instrument simulation from playing an instrument, possibly a reference to the actual instrument item. However, the case I've been able to look at so far has all instrument parts being simulated, so if there should be a reference it ought to appear at one of the -1 entries.","files":null}]}