{"version":1,"ops":[{"type":3,"author":{"id":"9498fe19b6b7827897b3244131948c9651cb6405"},"timestamp":1450203094,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NDg0NDkwNg==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-164844906"},"message":"Would merging this make it possible in the future to use TwbT without breaking other DFHack UI overlays? As an example, when using TwbT and the siege engine mod, the siege engine gui _replaces_ the map, rather than overlaying it.","files":null},{"type":3,"author":{"id":"7c3935464acdaaae9d6fcb27abcbbe21ec75027f"},"timestamp":1450208745,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NDg3NTA1Mw==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-164875053"},"message":"No, this would just mean we'd have to locate the hardcoded offsets TwbT needs. I'm not really sure what to do here, since I haven't seen documentation regarding what those offsets actually are.","files":null},{"type":3,"author":{"id":"32017ca1c5122073d1b8d82fe50a47cd8abb28c4"},"timestamp":1450230247,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NDk2MDAyNw==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-164960027"},"message":"\u003e Would merging this make it possible in the future to use TwbT without breaking other DFHack UI overlays?\n\nNo, but adding these structures would make it easier to keep TwbT up to date and perhaps include a standard version in DFHack.\n\nDFHack/dfhack#746 will avoid broken overlays, but there's a number of other plugins that need to change before that all shakes out.","files":null},{"type":3,"author":{"id":"7c3935464acdaaae9d6fcb27abcbbe21ec75027f"},"timestamp":1450233965,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NDk2ODgyOQ==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-164968829"},"message":"If you ask me, it would make it harder to keep twbt up to date, since\n- we don't know what those offsets are or how to represent them in df-structures - are they integers (if so, what size)? pointers to integers? pointers to more complex structures? random addresses in memory? addresses of executable code? If it's the latter, we don't have a good system in place that I know of for either defining those in structures or exposing ones defined in symbols.xml to C++.\n- It would add more work to a release. We've left out debug flags, save_on_exit, and startdwarfcount in some cases, so unless we can find a way to locate all of TwbT's offsets automatically, TwbT will either be broken or we'll have to wait for someone to locate them manually (and make sure they're correct, which has been a problem in the past)\n\nQuietust and Expwnent also pointed out several issues in TwbT that could prevent us from including it - I'm not sure how many of them have been fixed since then, but some are still present. Here's an incomplete list:\n- It can't be unloaded. Trying to unload it leaves it in a \"broken\" state, which means none of its commands work but the renderer remains active.\n- There are numerous magic numbers for things that are well-defined in df-structures. Some of them were incorrect at one point but have been fixed (e.g. the adventure mode ui menu), and the magic numbers could be outdated in 0.42.\n- Some advertised features are broken in unspecified ways (mapshot)\n- One offset is not required on Linux but \"may cause problems\". Apparently the solution requires recompiling libgraphics, which we can't rely on because many DFHack users use their own libgraphics (by choice or through their distro's package manager). It's also unclear exactly what the problem is without this offset, although it's apparently not a crash.\n- It breaks other DFHack tools (there has been progress made on this one)\n- There is some debug information logged that's irrelevant for users (pretty easy to fix, and most of it has been)\n\nI also haven't confirmed that DFHack/dfhack#746 will avoid broken overlays. In particular, I have no idea why scripts that just draw to the sidebar cause twbt's map display to break. Hopefully that can be figured out once DFHack is stable enough, and we can get rid of the separately-maintained plugins as well.","files":null},{"type":3,"author":{"id":"0e5495c3e6011298fa3fd53475b9a34c73d6b677"},"timestamp":1450635659,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NjE0MjM2OA==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-166142368"},"message":"re: \n\n\u003e I'm not really sure what to do here, since I haven't seen documentation regarding what those offsets actually are.\n\nDo you mean this:\nhttps://github.com/mifki/df-twbt/blob/master/PATCHES.md","files":null},{"type":3,"author":{"id":"7c3935464acdaaae9d6fcb27abcbbe21ec75027f"},"timestamp":1450658408,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2NjE2ODQ0NA==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-166168444"},"message":"That just tells you how to find seven offsets of things in memory. I have no idea what those things are, how to describe them in df-structures, or whether they're pointers to the data or executable segments (or both). A couple appear to be function pointers, which we don't have a way of describing (and there are some issues with including function pointers that are a little unclear to me, anyway).","files":null},{"type":5,"author":{"id":"7c3935464acdaaae9d6fcb27abcbbe21ec75027f"},"timestamp":1526055982,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE2MjIzMDk1NzM="},"added":["offsets"],"removed":[]},{"type":3,"author":{"id":"1daa046529992870662babb8e45eb2abbae215fb"},"timestamp":1532945165,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwODgxMzUzNQ==","github-url":"https://github.com/DFHack/df-structures/issues/61#issuecomment-408813535"},"message":"IMHO adding them could be done as generic \"offsets\" at first (or forever?). As for what they are:\n\n- A_LOAD_MULTI_PDIM  function - load image into df graphics\n- A_RENDER_MAP function - render map\n- A_RENDER_UPDOWN function - render up/down view in adventure mode\n\nThe rest i don't know, but i think they are specific offsets for various binary patches.","files":null}]}