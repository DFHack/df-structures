{"version":1,"ops":[{"type":1,"author":{"id":"25c4158f5dcc139ae07acba5a747e2de0c904e43"},"timestamp":1450644727,"metadata":{"github-id":"MDU6SXNzdWUxMjMxODIyMTI=","github-url":"https://github.com/DFHack/df-structures/issues/72","origin":"github"},"title":"Conversation structures research","message":"This was all done in 0.42.06.\n\nIn `ui_advmode.T_conversation`:\n- `unk4`: current page, starting at 0\n- `unk5`: vector of the first indices on each page\n- `unk6`: vector of the last indices on each page\n\nFor example, given 38 talk choices on 4 pages, `unk5` might be [0, 12, 24, 37] and `unk6` might be [11, 23, 36, 37], and `unk4` would be in the range 0 to 3.\n\nIn `ui_advmode.T_conversation.T_targets`:\n- `unk_8`: the conversation type\n  - 0: Talk to the figure identified by `unit_id` and `histfig_id`.\n  - 3: Shout out to everybody.\n  - 4: Begin a performance.\n\nIn `activity_event_conversationst`:\n- `anon_1`: vector of participants (see below). The first participant in the vector started the conversation.\n- `unk1`: what event is the topic of this turn, if any\n- `anon_2`: which menu and prompt to show next\n  - 0: Respond to greeting/Ignore/Impersonate\n  - 1: main menu\n  - 2: incident or rumor menu: \"What will you say about the trouble?\"\n  - 3: \"What will you say about the incident?\"\n  - 4: \"What will you say about the trouble?\"\n  - 5: \"What will you say about the incident?\"\n  - 6: Ask for whereabouts of a person or state opinion.\n  - 7: Respond to a goodbye.\n  - 8: crash\n  - 9: Deny sleep permission\n  - 10: Ask listener to join you\n  - 11: Respond to join request\n  - 12: \"What will you say about the rescue?\"\n  - 13: \"What will you say about the agreement?\"\n  - 14: \"What will you say about the trade?\"\n  - 15: \"What will you say about the surrounding area?\"\n  - 16: \"How will you respond to the accusation?\"\n  - 17: \"How will you respond about your profession?\"\n  - 18: \"What will you say about your family?\"\n  - 19: \"How will you respond to the request to cease hostilities?\"\n  - 20: \"How will you respond to the demand to yield?\"\n  - 21: \"What will you say about the trouble?\"\n  - 22: \"What will you say about the trouble?\"\n  - 23: Ask for directions\n  - 24: \"How will you respond to the request for directions?\"\n  - 25: \"How will you respond to the request for directions?\"\n  - 26: \"How will you respond to the request for a guide?\"\n  - 27: \"How will you respond to the request for a guide?\"\n  - 28: \"Where do you want to go?\"\n  - 29: \"What will you say about the structure?\"\n  - 30: demand menu\n  - 31: ?\n  - 32: Respond to request for something\n  - 33: Respond to request for something else\n  - 34: Initiate bartering\n  - 35: Respond to request for what to do as a hearthperson, e.g. \"enjoy these times of peace\"\n  - 36: ?\n  - 37: \"What will you say about the journey?\"\n  - 38: \"What will you say about the group?\"\n  - 39: \"What will you say about the conflict?\"\n  - 40: \"What will you say about the site?\"\n  - 41: Agree/refuse to comply with demand\n  - 42: ignorance/refuse to comply\n  - 43: Respond to demand for tribute\n  - 44: Respond to offer of tribute\n  - 45: Give opinion on trade cancellation\n  - 46: Respond to offer of peace\n  - 47: Give opinion on conclusion of agreement\n  - 48: Respond to adoption request\n  - 49: ?\n  - 50: Give opinion on something\n  - 51: Respond to position offer\n  - 52: \"How will you respond to the invocation?\"\n  - 53: ?\n  - 54: \"About whom do you ask?\"\n  - 55: \"How will you respond to the request for information?\"\n  - 56: \"What will you say about how you are feeling?\"\n  - 57: \"What will you say about services?\" with option to deny working here\n  - 58: \"What will you say about services?\" without that option\n  - 59: crash\n  - 60: \"How will you respond?\" – Respond to join request\n  - 61: ?\n  - 62: ?\n  - 63: state opinion\n  - 64: state opinion\n  - 65: Say something general about your emotional state or thoughts\n  - 66: State the value/worthlessness/nuances of `value_type`\n  - 67: \"How will you respond to this statement of values?\"\n  - 68: \"How will you respond to this passive reply?\"\n  - 69: \"How will you respond to this flattery?\"\n  - 70: \"How will you respond to this dismissal?\"\n  - 71: ?\n  - 72: ?\n  - out of range: goodbye menu\n- `anon_4`: current topic\n  - the `historical_figure` ID of a beast after asking its whereabouts\n  - the `world_site` ID of a site after asking directions to it\n  - a trouble type (see below) after asking about troubles\n  - the `historical_entity` ID of an entity after asking about the local ruler\n  - the number 294 after someone said they were \"out for some water\"; 748: tavern\n  - a `value_type` when discussing values\n- `anon_5`: more information about the current topic\n  - value strength when discussing values\n- `anon_6`: more information about the current topic\n  - the other participant’s value strength when discussing values?\n- `anon_9`: vector of conversation turns (see below)\n- `unk_80_unit`: `unit` ID of whosever turn it is to speak, or -1 if no one’s turn, in which case a (random?) participant will speak next\n- `anon_10`: `historical_figure` ID of the unit given by `unk_80_unit`\n- `anon_11`: number of instants since the last turn\n- `anon_12`: a bitfield\n  - 2: Use the string \"Continue shouting\" instead of listing all the non-adventurer participants.\n- `anon_13`: copy of `anon_2`\n- `anon_14`–`anon_23`: copy of `unk1`\n- `anon_24`: copy of `anon_3`\n\nIn `activity_event_conversationst.T_anon_1` (participant):\n- `anon_1`: unit ID of participant\n- `anon_2`: HF ID of participant\n\nIn `activity_event_conversationst.T_anon_9` (turn):\n- `anon_1`: speaker unit ID\n- `anon_2`: speaker HF ID\n- `anon_3`: the `talk_choice_type` of the turn\n- `anon_4`: the `entity_event` in question, if applicable, else garbage\n- `anon_6`: foreground color of report text\n- `anon_7`: background color\n- `anon_8`: brightness\n- `anon_9`: year the turn happened\n- `anon_10`: when the turn happened, in instants\n- `anon_11`–`anon_13` + `unk_v4014_1`: copies of `anon_2`–`anon_5` from the `talk_choice` that was chosen for this turn\n\nThe meanings of the fields in a `talk_choice` depend on its `type`.\n- `anon_2`:\n  - `StateOpinion`: opinion\n    - 0: State opinion that it must be stopped with violent force\n    - 1: State opinion that it is not your problem\n    - 2: State opinion that it was inevitable\n    - 3: State opinion that this is the life for you\n    - 4: State opinion that it is terrifying\n    - 5: State that you don't know anything about it\n    - 6: State that you are right in all matters\n    - 7: State that it is for the best\n    - 8: State that you don't care\n    - 9: State your general hatred\n    - 10: State your general fear\n    - 11: State opinion that it is sad but not unexpected\n    - 12: State opinion that it is terrible\n    - 13: State that it is terrific\n    - 14: State that you enjoyed performing\n    - 15: State that it was legendary\n    - 16: State that it was fantastic\n    - 17: State that it was great\n    - 18: State that it was good\n    - 19: State that it was okay\n    - 20: Agree completely\n    - 21: State that this is fantastic\n    - 22: State that this is great\n    - 23: State that this is good\n    - 24: State that this is okay\n    - 25: State that this is no good\n    - 26: State that this is your favorite dance\n    - 27: State that this is your favorite music (TODO: flag for melody vs. accompaniment)\n    - 28: State that this is your favorite poetry\n    - 29: State that you love reflective poetry\n    - 30: State that you hate reflective poetry\n    - 31: State that you love riddles\n    - 32: State that you hate riddles\n    - 33: State that you are embarrassed by this kind of humor\n    - 34: State your amusement\n    - 35: State that you love raunchy poems\n    - 36: State that you love ribald poems\n    - 37: State that you disapprove of ribald poems\n    - 38: State that you love light poems\n    - 39: State that you hate light poems\n    - 40: State that you love solemn poems\n    - 41: State that you hate solemn poems\n    - 42: State that listener's hunt saved you from an enemy (legendary/mighty)\n    - 43: State that listener's hunt saved you from an enemy (magnificent/fearsome)\n    - 44: State that listener's hunt saved you from an enemy (great/dangerous)\n    - 45: State that listener's hunt saved you from an enemy (worthy/)\n    - 46: State that listener's hunt saved you from an enemy (/nuisance)\n    - 47: State that listener had a good hunt (legendary)\n    - 48: State that listener had a good hunt (magnificent)\n    - 49: State that listener had a good hunt (great)\n    - 50: State that listener had a good hunt (worthy)\n    - 51: State that listener had a good hunt (hunter's work)\n    - 52: State that listener saved you from an enemy (mighty)\n    - 53: State that listener saved you from an enemy (fearsome)\n    - 54: State that listener saved you from an enemy (dangerous)\n    - 55: State that listener saved you from an enemy ()\n    - 56: State that listener saved you from an enemy (nuisance)\n    - 57: State that they are outlaws\n    - 58: State that listener protected the defenseless from outlaws\n  - respond to invitation to insurrection (27), `RespondJoin`, `RespondJoin2`, respond to something else (112), respond to invitation to entertain (181): invitation response:\n    - -1: \"I would... rather not.\"\n    - 0: \"Hey... that sounds like a great idea!\"\n    - 1: \"Surely any place is better than this. Let's set off immediately!\"\n    - 2: \"I've always wanted to travel the world. Let us be off!\"\n    - 3: \"Excitement! Adventure! I am thrilled to join you.\"\n    - 4: \"I will agree to travel with you if you lead me to glory and death.\"\n    - 5: \"I'm sorry. My duty is here.\"\n    - 6: \"It is I that would lead you, but I have no need of your protection.\"\n    - 7: \"Ha! Such enthusiasm from one such as yourself.\"\n    - 8: \"With a band so large, what share of the glory would I have?\"\n    - 9: \"Take me away from here.\"\n    - 10: ditto\n    - 11: \"I'm sorry. I can't go with you.\"\n    - 12: \"I have no interest in your objectives.\"\n    - 13: \"Let us leave as soon as possible.\"\n    - 14: \"This is a cause worthy of struggle.\"\n    - 15: \"Keep practicing!\"\n    - 16: \"Maybe after you've improved.  Prove you have what it takes.  The life of the traveling performer is a hard one.\"\n    - 17: \"Can you manage a troupe so large?\"\n    - 18: \"That's such a fantastic idea.  I can't wait to be off!\"\n    - 19: \"It's such a noble pursuit.  Let's go immediately!\"\n    - 20: \"It would be so great to perform and make people happy.\"\n    - 21: \"I so love the performing arts.  It's time to go!\"\n    - 22: \"I'd love to travel and create art.\"\n    - 23: \"The performing arts are so important.  Let's go!\"\n    - 24: \"Let's spread the joy!\"\n    - 25: \"The performances will be great.\"\n    - 26: \"A demonstration of your skill might convince me.\"\n  - `SuggestTravel`, `AskDirectionsPlace`, `RequestGuide`, `ProvideDirections`: `world_site` ID of destination\n  - `SuggestTalk`, `StateUnitLocation`, `AskWhereabouts`, `RequestGuide2`, `ProvideWhereabouts`, `TellTargetDead`, `RecommendGuide`, `SummarizeViews`, `ExpressAstonishment`, ask about someone (170), respond to question about someone (171): `historical_figure` ID\n  - `HawkWares`, `AskLocationObject`, `DemandDropWeapon`: `item` ID\n  - `ExpressOverwhelmingEmotion`, `ExpressGreatEmotion`, `ExpressEmotion`, `ExpressMinorEmotion`, `ExpressLackEmotion`: `emotion_type`\n  - `AskAboutIncident`: trouble type (see below)\n  - `CancelAgreement`: `agreement` ID\n  - `SummarizeConflict`: `activity_entry` ID\n  - `DemandTribute`, `OfferGiveTribute`, `CancelTribute`, `OfferPeace`, `OfferService`: `historical_entity` ID of the first entity (tributary)\n  - `AskAboutIncident`: whether the trouble should be singular (≤1) or plural (\u003e1) for troubles that have both forms, e.g. \"army\"/\"armies\"\n  - order drink (176): index of the drink in the list of available drinks\n  - ask to join an existing troupe (182), invite to join a troupe (184), kick out of troupe (188), leave troupe (190): `historical_entity` ID of the troupe\n  - leave group (190): `historical_entity` ID of the group to leave\n  - state values (198), argue values (201), acquiesce (205): `value_type`\n  - give directions to building (200): the index of the building in the `world_site`’s `buildings`\n  - ask for work for group (211): `historical_entity` ID of the prospective employee\n  - give order (216): `squad_order_type` (only `DRIVE_ENTITY_OFF_SITE` and kill (7) seem to work)\n- `anon_3`:\n  - `StateOpinion`, `ExpressOverwhelmingEmotion`, `ExpressGreatEmotion`, `ExpressEmotion`, `ExpressMinorEmotion`, `ExpressLackEmotion`: `unit_thought_type`\n  - `DemandTribute`, `OfferGiveTribute`, `CancelTribute`, `OfferPeace`: `historical_entity` ID of the second entity (receiver of tribute)\n  - `StateUnitLocation`, give directions to building (200): `world_site` ID\n  - `InvokeNameBanish`, `InvokeNameService`: `identity` ID\n  - state values (198), argue values (201), acquiesce (205): value strength (very negative = worthlessness; around 0 = nuances; very positive = value)\n  - ask for work for oneself (210), ask for work for group (211): `historical_entity` ID of prospective employer\n  - give order (216): It depends on `anon_2`:\n    - `DRIVE_ENTITY_OFF_SITE`: -1\n    - kill (7): `historical_figure` ID\n- `anon_4`:\n  - `StateOpinion`, `ExpressOverwhelmingEmotion`, `ExpressGreatEmotion`, `ExpressEmotion`, `ExpressMinorEmotion`, `ExpressLackEmotion`: It depends on `anon_3`:\n    - `UnexpectedDeath`, `Death`, `LoveSeparated`, `LoveReunited`, `NewRomance`, `MadeFriend`, `FormedGrudge`, `Prayer`: `historical_figure` ID\n    - `Kill`: `incident` ID of an incident with a valid `killer_hfid`\n    - `MadeArtifact`: `artifact_record` ID\n    - `MasterSkill`, `LearnSkill`, `TeachSkill`, `ImproveSkill`: `job_skill` ID\n    - `Complained`, `ReceivedComplaint`, `UnableComplain`: complaint:\n      - 25: \"I brought up the lack of jobs in a meeting.\"\n      - 26: \"I made a suggestion about work allocations in a meeting.\"\n      - 27: \"I requested that more weapons be produced in a meeting.\"\n      - 28: \"I yelled at somebody in charge.\"\n      - 29: \"I cried on somebody in charge.\"\n    - `AdmireBuilding`, `AdmireOwnBuilding`, `AdmireArrangedBuilding`, `AdmireOwnArrangedBuilding`: `building_type` ID\n    - `GhostNightmare`, `GhostHaunt`, `SpouseGaveBirth`, `Talked`, `Decay`: `unit_relationship_type`\n      - Note that `SpouseGaveBirth` can produce \"I got married.\", \"I have a new sibling.\", or \"I have become a parent.\" A better name would be `NewFamilyMember`.\n    - `RoomPretension`: `unit_demand.T_place`\n    - `AnnoyedVermin`, `NearVermin`, `PesteredVermin`, `NearCaged`, `NearCaged2`: `creature_raw` index\n    - `AttackedByDead`: `histfig_relationship_type`\n    - `GaveBirth`: -1=child, 0=girl, 1=boy\n      - This is the same pattern as `historical_figure.sex`, `unit.sex`, `item_body_component.sex`, and `caste_raw.gender`. Perhaps an enum should be defined and referred to by all of them.\n    - `NeedsUnfulfilled`: `need_type`\n    - `ResearchBreakthrough`, `ResearchStalled`, `PonderTopic`, `DiscussTopic`, `LearnTopic`, `TeachTopic`: an integer in [0, 13], equivalent to `knowledge_scholar_category_flag.flags`\n    - `Syndrome`: `syndrome` ID\n    - `LearnBook`, `ReadBook`, `WroteBook`: `written_content` ID\n    - `LearnInteraction`: `interaction` ID\n    - `LearnPoetry`: `poetic_form` ID\n    - `LearnMusic`: `musical_form` ID\n    - `LearnDance`: `dance_form` ID\n    - `BecomeResident`, `DenyResident`: `world_site` ID\n    - `BecomeCitizen`, `DenyCitizen`: `historical_entity` ID of site government\n    - `PlayToy`: `itemdef_toyst` ID\n    - `Argument`: `historical_figure` ID of the other arguer\n    - `RealizeValue`: `value_type`\n    - simulated musical instrument (220), played musical instrument (221): `itemdef_instrumentst` ID\n  - `CancelAgreement`: reason for cancellation?\n    - 13: \"We can no longer travel together.\"\n    - 52: \"We haven't performed for some time.  We were going to entertain the world!  It's a shame, but I'll have to make my own way now.\"\n  - ask for work for oneself (210), ask for work for group (211), grant work request: `occupation_type`\n  - give order (216): It depends on `anon_2`:\n    - `DRIVE_ENTITY_OFF_SITE`: `world_site` ID\n    - kill (7): -1\n- `anon_5`:\n  - `StateOpinion`: It depends on `anon_3`:\n    - `OfficeQuality`: quality of the setting:\n      - 1: good\n      - 2: very good\n      - 3: great\n      - 4: fantastic\n      - 5: worthy of legends\n    - `NeedsUnfulfilled`: It depends on `anon_4`:\n      - `PrayOrMedidate`: `historical_entity` ID to pray to, or -1 for meditation\n    - `ResearchBreakthrough`, `ResearchStalled`, `PonderTopic`, `DiscussTopic`, `LearnTopic`, `TeachTopic`: an integer in [0, 31], equivalent to log\u003csub\u003e2\u003c/sub\u003e of the `knowledge_scholar_category_flag.category` in the bitfield identified by `anon_4`\n    - `WearItem`: `item_quality`\n  - `ExpressOverwhelmingEmotion`, `ExpressGreatEmotion`, `ExpressEmotion`, `ExpressMinorEmotion`, `ExpressLackEmotion`: It depends on `anon_3`:\n    - `GhostHaunt`: haunting type\n      - 0: haunted\n      - 1: tormented\n      - 2: possessed\n      - 3: tortured\n    - `GaveBirth`, `SpouseGaveBirth`: how many new family members\n      - `GaveBirth`: not in range 1–15 is \"many babies\"\n      - `SpouseGaveBirth`: ≤1 is singular, \u003e1 is plural; applies to new sibling(s) only\n    - `RealizeValue`: value strength\n  - give order (216): It depends on `anon_2`:\n    - `DRIVE_ENTITY_OFF_SITE`: `historical_entity` ID\n    - kill (7): -1\n\nA trouble type is an enum:\n- 0: deaths\n- 1: law-breaking\n- 2: the fighting\n- 3: armies on the march\n- 4: abductions\n- 5: occupations\n- 6: beasts\n- 7: criminals\n- 8: bandits\n- 9: skulking vermin\n- 10: bone-chilling horror\n- 11: ruffians\n- 12: open war\n- 13: brewing trouble with our neighbors\n\nMeanings for anonymous `talk_choice_type` values:\n- 27: respond to proposal of insurrection\n- 28: \"I'm with you on this.\"; respond to proposal of rescue? (TODO: unattested)\n- 44: \"Thank you!\" (as a response to \"Come with me and I'll bring you to safety.\")\n- 104: Claim this site for yourself (group naming menu)\n- 112: respond to some kind of proposal; I’m not sure what\n- 169: Ask about somebody (new menu)\n- 170: ask about somebody\n- 171: give information about somebody\n- 172: \"How are you feeling right now?\"\n- 173: Say something general about your emotional state or thoughts\n- 174: Ask about available services, drinks, rooms, etc.\n- 175: List available services (\"We have many drinks to choose from.\" / \"This is not that kind of establishment.\")\n- 176: Order drink\n- 177: Rent room\n- 178: Extend room rental\n- 179: Confirm service order (\"I'll be back with your drink in a moment.\" / \"Your room is up the stairs, the first door on your right.\" / \"You'll have the room for another day.  I'm glad you're enjoying your stay.\")\n- 180: Ask listener to join you as entertainer\n- 181: Respond to join request (entertainer)\n- 182: ask to join an existing troupe\n- 183: \"I am confused.\" (probably a fallback message)\n- 184: Refuse request to join your troupe\n- 185: Invite listener to join troupe\n- 186: Accept invitation to join troupe\n- 187: Refuse invitation to join troupe\n- 188: Kick listener out of troupe\n- 189: Create a performance troupe together (group naming menu)\n- 190: leave troupe\n- 191: \"Tavern keeper! Uh... nevermind.\" (TODO)\n- 192: \"Please be patient. I'll have your order ready in a moment.\"\n- 193: \"We don't offer any specific services here.\"\n- 194: \"Yes, I can serve you when we're both there.\"\n- 195: \"I don't work here.\"\n- 196: Express your emotions (new menu)\n- 197: State your values (new menu)\n- 198: state value/worthlessness/nuances\n- 199: try to trade or settle debts when you don’t owe anything\n- 200: Give directions to building\n- 201: Argue\n- 202: Flatter the listener\n- 203: Dismiss the listener's argument\n- 204: Respond passively\n- 205: Acquiesce (changes your values)\n- 206: Deride flattery\n- 207: Express outrage over dismissal\n- 208: Press the argument\n- 209: Agree to drop the argument\n- 210: ask for work for oneself\n- 211: ask for work for a group\n- 212: Grant listener work (one person)\n- 213: Refuse listener work (one person)\n- 214: Grant listener work (a group)\n- 215: Refuse listener work (a group)\n- 216: Give order\n\nMeanings for anonymous `squad_order_type` values:\n- 7: kill historical figure\n- 8: drive armies off site","files":null}]}