{"version":1,"ops":[{"type":1,"author":{"id":"7c3935464acdaaae9d6fcb27abcbbe21ec75027f"},"timestamp":1468611870,"metadata":{"github-id":"MDU6SXNzdWUxNjU4NjMzMDI=","github-url":"https://github.com/DFHack/df-structures/issues/155","origin":"github"},"title":"ui_advmode research","message":"Migrated from https://github.com/DFHack/dfhack/issues/942\n\n\u003e **df.global.ui_advmode.anon_9**\n\u003e This is initially equal to df.global.cur_year_tick_advmode and they both increase at the same rate. However, it does not seem to update when sleeping and fast-travelling, resulting in a value which differs from df.global.cur_year_tick_advmode\n\u003e \n\u003e **df.global.ui_advmode.anon_50**\n\u003e Hours of sleep. This value is updated whenever the player changes the number of hours to be slept when viewing the sleep menu.\n\u003e \n\u003e **df.global.ui_advmode.anon_56**\n\u003e Is usually set to **0**\n\u003e Is set to **2** when the adventurer unit is unconscious/falling\n\u003e Setting it to **0** when the adventurer is unconscious allows the player to move the adventurer, but it is immediately set to **2** again if the unit is still unconscious\n\u003e Hence, it seems that this is what prevents a player from controlling the adventurer when such a status effect is in play.\n\u003e \n\u003e **df.global.ui_advmode.anon_59 \n\u003e df.global.ui_advmode.anon_60\n\u003e df.global.ui_advmode.anon_61**\n\u003e anon_59 is an x coordinate, anon_60 is y, anon_61 is z\n\u003e These coordinates appear to be set when the adventurer becomes a projectile via jumping/falling; they are the coordinates where the flight trajectory ends (not necessarily the chosen target coordinates when jumping).\n\u003e \n\u003e **df.global.ui_advmode.anon_15\n\u003e df.global.ui_advmode.anon_16\n\u003e df.global.ui_advmode.anon_17**\n\u003e anon_15 appears to contain a list of x coordinates\n\u003e anon_16 appears to contain a list of y coordinates\n\u003e anon_17 appears to contain a list of z coordinates\n\u003e (values in each list are initially set to -1000000)\n\u003e Each entry is likely combined with its equivalents in the other anons, but the overall function remains unknown.\n\u003e \n\u003e **df.global.ui_advmode.anon2\n\u003e df.global.ui_advmode.anon3**\n\u003e and\n\u003e **df.global.ui_advmode.unk23\n\u003e df.global.ui_advmode.unk24**\n\u003e The above two pairs appear to be linked with the adventurer’s position on the map, though I’m not yet sure about the specifics. The values appear to be updated only when the map is reloaded, or when the adventurer enters travel mode.\n\u003e \n\u003e **df.global.ui_advmode.menu = 30** \n\u003e The “select target” screen for interactions\n\u003e \n\u003e The following are set when the adventurer loads the interaction target selection screen:\n\u003e \n\u003e **df.global.ui_advmode.unk_1e8** \n\u003e Used when the interaction is a “natural ability” (otherwise, it is set to -1)\n\u003e Relates to the interaction's index in the adventurer's unit.curse.own_interaction\n\u003e \n\u003e **df.global.ui_advmode.unk_1ec**\n\u003e Used for acquired interactions (otherwise set to -1)\n\u003e This relates to the interaction as shown below: df.interaction.find(df.global.world.raws.effects.interactions[df.global.ui_advmode.unk_1ec])\n\u003e \n\u003e **df.global.ui_advmode.unk_f4**\n\u003e The maximum number of targets for the interaction \n\u003e \n\u003e **df.global.ui_advmode.unk_f8**\n\u003e The maximum range of the interaction\n\u003e \n\u003e **df.global.ui_advmode.unk_fc**\n\u003e Possibly relates to the interaction target type?\n\u003e For example, changing it to “4” made “disturber only” show up on the target selection screen.\n\u003e “2” = adjacent only , “6” = adjacent only, disturber only\n\u003e However, higher values seem to be repetitions, so I am uncertain about this.\n\u003e \n\u003e **df.global.ui_advmode.unk_1e4\n\u003e df.global.ui_advmode.unk_f0\n\u003e df.global.ui_advmode.unk_200**\n\u003e Unknown function, but changing their value crashes the game upon attempting to view the interaction screen. \n\u003e unk_f0 and unk_200 appear to be reset to 0 once the interaction is carried out\n\u003e \n\u003e **df.global.ui_advmode.unk37\n\u003e df.global.ui_advmode.unk38**\n\u003e Contain userdata which seems to be created upon when the interaction target selection screen is loaded. Deleting the userdata in unk38 causes any available target choices to disappear. Moving the cursor causes it to reappear, with userdata being generated again. Userdata in unk37 does not seem to regenerate.","files":null}]}