{"version":1,"ops":[{"type":6,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581590022,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNTA2NzE5OTc="},"target":"61903e1ec93761ac0f42a75e35f22e17f47e495b37aebf634de48b925a696600","message":"I don't know if someone is already working on it, or if they are already tracked. Here are a few invalid vectors and pointers I found on v0.47.02 linux64 using df-structures 424ccedfcde133b295d11a8ff4638cefaf167c6d.\n\n- [x] `unit_soul.performance_skills` (`0x100000001` for my dwarves, not a valid pointer)\n- [ ] `army_controller.unk_44` (vector pointers are `0xffffffffffffffff`, `0xffffffffffffffff`, `0x0`)\n- [ ] `world_region.forces` (different values, one example: `0x1400000004`, `0x20000001b`, `0x3c090000000008`)\n- [ ] `world.features.feature_global_idx`, this one could be a valid vector but not of int32_t (size 18 bytes, capacity 32 bytes).\n- [ ] `world.features.anon_1`, a vector too but not of pointers (size 36 bytes, capacity 64 bytes)","files":null},{"type":6,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581590024,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNTA2NzIwMTE="},"target":"61903e1ec93761ac0f42a75e35f22e17f47e495b37aebf634de48b925a696600","message":"I don't know if someone is already working on it, or if they are already tracked. Here are a few invalid vectors and pointers I found on v0.47.02 linux64 using df-structures 424ccedfcde133b295d11a8ff4638cefaf167c6d.\n\n- [x] `unit_soul.performance_skills` (`0x100000001` for my dwarves, not a valid pointer)\n- [x] `army_controller.unk_44` (vector pointers are `0xffffffffffffffff`, `0xffffffffffffffff`, `0x0`)\n- [ ] `world_region.forces` (different values, one example: `0x1400000004`, `0x20000001b`, `0x3c090000000008`)\n- [ ] `world.features.feature_global_idx`, this one could be a valid vector but not of int32_t (size 18 bytes, capacity 32 bytes).\n- [ ] `world.features.anon_1`, a vector too but not of pointers (size 36 bytes, capacity 64 bytes)","files":null},{"type":6,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581590025,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNTA2NzIwMjI="},"target":"61903e1ec93761ac0f42a75e35f22e17f47e495b37aebf634de48b925a696600","message":"I don't know if someone is already working on it, or if they are already tracked. Here are a few invalid vectors and pointers I found on v0.47.02 linux64 using df-structures 424ccedfcde133b295d11a8ff4638cefaf167c6d.\n\n- [x] `unit_soul.performance_skills` (`0x100000001` for my dwarves, not a valid pointer)\n- [x] `army_controller.unk_44` (vector pointers are `0xffffffffffffffff`, `0xffffffffffffffff`, `0x0`)\n- [x] `world_region.forces` (different values, one example: `0x1400000004`, `0x20000001b`, `0x3c090000000008`)\n- [ ] `world.features.feature_global_idx`, this one could be a valid vector but not of int32_t (size 18 bytes, capacity 32 bytes).\n- [ ] `world.features.anon_1`, a vector too but not of pointers (size 36 bytes, capacity 64 bytes)","files":null},{"type":6,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1582735487,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNTQ2NjMxNDU="},"target":"61903e1ec93761ac0f42a75e35f22e17f47e495b37aebf634de48b925a696600","message":"I don't know if someone is already working on it, or if they are already tracked. Here are a few invalid vectors and pointers I found on v0.47.02 linux64 using df-structures 424ccedfcde133b295d11a8ff4638cefaf167c6d.\n\n- [x] `unit_soul.performance_skills` (`0x100000001` for my dwarves, not a valid pointer)\n- [x] `army_controller.unk_44` (vector pointers are `0xffffffffffffffff`, `0xffffffffffffffff`, `0x0`)\n- [x] `world_region.forces` (different values, one example: `0x1400000004`, `0x20000001b`, `0x3c090000000008`)\n- [x] `world.features.feature_global_idx`, this one could be a valid vector but not of int32_t (size 18 bytes, capacity 32 bytes).\n- [ ] `world.features.anon_1`, a vector too but not of pointers (size 36 bytes, capacity 64 bytes)","files":null},{"type":6,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1582735489,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNTQ2NjMxNDc="},"target":"61903e1ec93761ac0f42a75e35f22e17f47e495b37aebf634de48b925a696600","message":"I don't know if someone is already working on it, or if they are already tracked. Here are a few invalid vectors and pointers I found on v0.47.02 linux64 using df-structures 424ccedfcde133b295d11a8ff4638cefaf167c6d.\n\n- [x] `unit_soul.performance_skills` (`0x100000001` for my dwarves, not a valid pointer)\n- [x] `army_controller.unk_44` (vector pointers are `0xffffffffffffffff`, `0xffffffffffffffff`, `0x0`)\n- [x] `world_region.forces` (different values, one example: `0x1400000004`, `0x20000001b`, `0x3c090000000008`)\n- [x] `world.features.feature_global_idx`, this one could be a valid vector but not of int32_t (size 18 bytes, capacity 32 bytes).\n- [x] `world.features.anon_1`, a vector too but not of pointers (size 36 bytes, capacity 64 bytes)","files":null},{"type":3,"author":{"id":"805b72f313ac2ff3c485597698a4e82b28cbea62"},"timestamp":1581459406,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NDg4MzI1MQ==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-584883251"},"message":"I loaded the medium world from https://files.dfhack.org/saves/ in legends mode and here's what `check-structures-sanity` found:\n\n```\nuninitialized pointers:\n\ndf::global::world.entities.all[#].unknown2.region\n\nbad vectors:\n\ndf::global::world.world_data.regions[#].forces\ndf::global::world.army_controllers.all[#].unk_44\n\nmissing classes from structures:\n\ncreature_interaction_effect_close_open_woundsst\ncreature_interaction_effect_cure_infectionst\ncreature_interaction_effect_heal_nervesst\ncreature_interaction_effect_heal_tissuesst\ncreature_interaction_effect_reduce_dizzinessst\ncreature_interaction_effect_reduce_feverst\ncreature_interaction_effect_reduce_nauseast\ncreature_interaction_effect_reduce_painst\ncreature_interaction_effect_reduce_paralysisst\ncreature_interaction_effect_reduce_swellingst\ncreature_interaction_effect_regrow_partsst\ncreature_interaction_effect_special_attack_interactionst\ncreature_interaction_effect_stop_bleedingst\ninteraction_effect_change_item_qualityst\ninteraction_effect_change_weatherst\ninteraction_effect_create_itemst\ninteraction_effect_propel_unitst\ninteraction_effect_summon_unitst\ninteraction_source_experimentst\n```\n\nIf you want to run `check-structures-sanity`, make sure you're on the latest version, because there's a pretty big flaw in how it handles pointer vectors that will give you lots of false positives and probably balloon memory to the point where it crashes on older versions of it.","files":null},{"type":3,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581513935,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTIwMzYwNg==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585203606"},"message":"#347 fixes world_region.forces\n\n\u003e If you want to run check-structures-sanity, make sure you're on the latest version, because there's a pretty big flaw in how it handles pointer vectors that will give you lots of false positives and probably balloon memory to the point where it crashes on older versions of it.\n\nI am not actually using check-structures-sanity, I am experimenting with reading df data from external applications, and I thought trying some validation was a good test for both my code and df-structures. I did double-check with gui/gm-editor that the vectors/pointers were bad.\n\nI just tried a freshly pulled check-structures-sanity (https://github.com/DFHack/dfhack/commit/40bd55c558ee97598f4c4ca9e7c60915c84d3bc7), I saw the same vectors so no false positives, but memory usage went crazy (14Gb when I killed it).","files":null},{"type":3,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1581589551,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTY1NjQ5MQ==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585656491"},"message":"I've failed to find any case of \"unk_44\" or the unk_v47_X fields added after it being non zero for the army_controller case in any of the saves I've looked at. Given what @cvuchener has seen, it's reasonable to assume at least two of the 4 new padding fields should go before the vector.","files":null},{"type":3,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581590099,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTY2MDE0Nw==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585660147"},"message":"unk_44 (as a vector) does not exist any more since ab5a7d96f62a80d891ffbbeeebd37c25016f954f.","files":null},{"type":3,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1581590493,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTY2Mjc0Ng==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585662746"},"message":"Thanks. I refreshed my copy with the latest data from github an hour ago, and it claimed to get some stuff, but this wasn't updated. I'll look for another red herring to chase ;)","files":null},{"type":3,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581601360,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTc1OTUxNw==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585759517"},"message":"On linux32, `ui_sidebar_menus.command_line` contains invalid strings and vectors (dfhack crashes on main menu because of that).\n\n```\n(gdb) x/20xw \u0026df::global::ui_sidebar_menus-\u003ecommand_line\n0x9717238:\t0x00000000\t0x0962305c\t0x00000000\t0x00000000\n0x9717248:\t0x00000000\t0xffffffff\t0x00000000\t0x00000000\n0x9717258:\t0x0962305c\t0x00000000\t0x0000003f\t0x00000000\n0x9717268:\t0x00000000\t0x00000000\t0x00000000\t0x00000000\n0x9717278:\t0x00000000\t0x00000000\t0x00000000\t0x00000000\n```\n`0x0962305c` is the empty string (`_ZNSs4_Rep20_S_empty_rep_storageE+12`). Adding 4 bytes before `command_line` could fix it. I need to find a way to do that without breaking 64 bits structures, maybe a int32_t or smaller hidden in the padding of the previous compound. Did anyone test dfhack on win32?","files":null},{"type":3,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1581602372,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4NTc2Njk3Ng==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-585766976"},"message":"`ui_sidebar_menus.minimap.tile` is also off by 4 bytes on linux64, so the new int32_t is before that. I don't know what to expect in `ui_sidebar_menus.minimap.data` so I cannot comment on that.","files":null},{"type":3,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1582207085,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU4OTA0NTk3NA==","github-url":"https://github.com/DFHack/df-structures/issues/346#issuecomment-589045974"},"message":"`world.features` is fixed by #359","files":null},{"type":4,"author":{"id":"b557f89d859694906b6aaad860dfa0f74f23dbaa"},"timestamp":1582735494,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzA3NDU0NDI2NA=="},"status":2}]}