{"version":1,"ops":[{"type":1,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1499368434,"metadata":{"github-id":"MDU6SXNzdWUyNDEwNTcyMDU=","github-url":"https://github.com/DFHack/df-structures/issues/206","origin":"github"},"title":"On the organization of df.world_data.xml:world_data.feature_map","message":"I believe this structure to be a two dimensional array ceiling (map_width/16) * ceiling (map_height/16). However, these top level elements seem to be allocated only when needed, i.e. the pointers to the cells may be null pointers, leading to DF crashing when trying to access them. Once allocated the cells seem to be retained, however for the rest of the game session.\n  The allocation of a cell does not mean the contents is allocated, though, only that the top structure is. The\n'features' element is frequently a null pointer which doesn't get allocated until it's needed, i.e. when one of the world tiles in the cell needs to have its feature data defined.\n Once the features structure is allocated it still isn't complete, as the 'feature_init' 16*16 matrix over the world map tiles of the cell only populates the feature lists of the world tiles it needs data for, with the other tiles having zero length lists. Again, once a list has been populated during the current session it remains populated.\n\nIf verified, it would be useful to have the structure and its probable state of incompleteness being documented in a legible fashion in the XML file (The explanation of the world_region_details.edges field is a precedence of a larger description in the same file).","files":null}]}