{"version":1,"ops":[{"type":1,"author":{"id":"dc07f1dff8eee6d97a060efd0e58b122b9009d24"},"timestamp":1498663009,"metadata":{"github-id":"MDU6SXNzdWUyMzkxOTk1OTA=","github-url":"https://github.com/DFHack/df-structures/issues/204","origin":"github"},"title":"df.world-data.xml:world_underground_region unknown parameter proposal","message":"All of the unk_* fields were 0 for the magma sea and hell, so those levels are ignored below.\nunk_7a: probably \"water\".\nunk_7c: No idea. No obvious relation to unk_7a\nunk_7e: Probably \"openness_min\"\nunk_80: Probably \"openness_max\"\nunk_82: Probably \"passage_density_min\"\npassage_density: Probably actually \"passage_density_max\"\n\nThis assumption is supported by not finding any value outside of the expected  for a large region with the following parameter:\nOpenness Min/Max: 25-50\nDensity Min/Max: 1-24\nWater Min/Max: 76-90\nusing the following Lua script:\n`function x ()\n  for i, region in ipairs (df.global.world.world_data.underground_regions) do\n    if region.layer_depth \u003c 3 then\n\t  if region.unk_7a \u003c df.global.world.worldgen.worldgen_parms.cavern_layer_water_min or\n\t     region.unk_7a \u003e df.global.world.worldgen.worldgen_parms.cavern_layer_water_max then\n\t    dfhack.println (\"Water out of bounds\")\n\t  end\n\t \n\t  if region.unk_7e \u003c df.global.world.worldgen.worldgen_parms.cavern_layer_openness_min or \n\t     region.unk_7e \u003e df.global.world.worldgen.worldgen_parms.cavern_layer_openness_max then\n\t    dfhack.println (\"Openness min out of bounds\")\n\t  end\n\n\t  if region.unk_80 \u003c df.global.world.worldgen.worldgen_parms.cavern_layer_openness_min or \n\t     region.unk_80 \u003e df.global.world.worldgen.worldgen_parms.cavern_layer_openness_max or\n\t\t region.unk_7e \u003e region.unk_80 then\n\t    dfhack.println (\"Openness max out of bounds\")\n\t  end\n\t  \n\t  if region.unk_82 \u003c df.global.world.worldgen.worldgen_parms.cavern_layer_passage_density_min or\n\t     region.unk_82 \u003e df.global.world.worldgen.worldgen_parms.cavern_layer_passage_density_max then\n\t\tdfhack.println (\"Density min out of bounds\")\n\t  end\n\t  \n\t  if region.passage_density \u003c df.global.world.worldgen.worldgen_parms.cavern_layer_passage_density_min or\n\t     region.passage_density \u003e df.global.world.worldgen.worldgen_parms.cavern_layer_passage_density_max or\n\t\t region.passage_density \u003c region.unk_82 then\n\t\tdfhack.println (\"Density max out of bounds\")\n\t  end\n\t  \n      dfhack.println (region.layer_depth, region.unk_7a, region.unk_7c, region.unk_7e, region.unk_80, region.unk_82, region.passage_density)\n\tend\n  end\nend\n\nx ()`\n\nEdit:\nI believe unk_7a \u003c 9 =\u003e Biome = Subterranean Chams, while \u003e= 10 =\u003e Subterranean Water. I performed the following experiment:\nEmbark on a world tile and used \"reveal all\" to view the caverns.\ncavern 1: unk_7a = 4; muddy\ncavern 2: unk_7a = 0; muddy\ncavern 3: unk_7a = 10: \"normal\"\nDeleting the world and loading a copy, editing the unk_7a values, embarking at the same location, and revealing:\ncavern 1: unk_7a = 10; generic grass (no plants were present in the biome's population)\ncavern 2: unk_7a = 10; ditto\ncavern 3: unk_7a = 9; Mud covered, but normal shrubs, saplings and trees, but no moss.\n\nEdit 2:\nFurther experiments indicates the previous thought on unk_7a is incorrect, and it probably is better called \"muddiness\"  (changed above). 0-9 generates muddy caverns, but so does 91-100. However, The high range muddy caverns have been seen \"naturally\" together with both lakes and cavern trees and bushes (but not \"grass\", i.e. moss). Also, I have been completely unable to get cavern lakes to form in my world generated with a 0-25 cavern water world gen parameter range. I've played with unk_7c together with unk_7a as well as observed both on \"natural\" worlds without getting any understanding of unk_7c.\n\nEdit 3:\nIgnore Edit 2. Those are the results you get if the region you're going to embark in is in focus when you change the parameter. When changing the parameter from 39/29/39 for the 3 caverns to 100/100/100 while the embark was not in focus caused the embark to change from a bit of water in the 3:rd cavern to all of them almost covered (the 2:nd one had a little higher, muddy, ground).\n\nEdit 4:\nIt seems the amount of water is roughly controlled by world_data.region_details[0].features[x][y][l].unk_30, where x/y are region coordinates and l is the feature entry for the cavern. The first 4 bits of the unk_30 array seems to control about 25% of the cavern for that mid level tile, but water did only appear with a Water parameter value of 39, but not one of 29, so there's probably a minimum value required for water to appear. I failed to see a clear correspondence between the water location and the bit set.\n\nEdit 5:\nGradually increasing the value of unk_7a indicates it is accompanied by a gradual increase of the number of world_data.region_details[0].features[x][y][l].unk_30 flags being set both counted as number of flags per tile and number of tiles with flags set. At 100 I found at least one flag being set on 98/93/97% of the tiles of the three caverns in my test region (counting only cavern tiles belonging to the world tile's underground regions, not those of \"encroaching\" neighbors). Interestingly, a value of 9 resulted in muddy caverns, but some tiles actually had flags set, and checking one such case showed that the cavern actually had water in it together with mud. A value of 5 saw 0 flags set.","files":null}]}